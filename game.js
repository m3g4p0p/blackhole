(()=>{var Wt=Object.defineProperty,Gr=Object.defineProperties,Vr=Object.getOwnPropertyDescriptors,$t=Object.getOwnPropertySymbols,zr=Object.prototype.hasOwnProperty,Jr=Object.prototype.propertyIsEnumerable,Qt=(e,t,a)=>t in e?Wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Oe=(e,t)=>{for(var a in t||(t={}))zr.call(t,a)&&Qt(e,a,t[a]);if($t)for(var a of $t(t))Jr.call(t,a)&&Qt(e,a,t[a]);return e},it=(e,t)=>Gr(e,Vr(t)),s=(e,t)=>Wt(e,"name",{value:t,configurable:!0}),me=(e,t)=>()=>(e&&(t=e(e=0)),t),Kr=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);function Zt(e){return e*Math.PI/180}function er(e){return e*180/Math.PI}function ge(e,t,a){return t>a?ge(e,a,t):Math.min(Math.max(e,t),a)}function ze(e,t,a){return e+(t-e)*a}function Je(e,t,a,r,c){return r+(e-t)/(a-t)*(c-r)}function tr(e,t,a,r,c){return ge(Je(e,t,a,r,c),r,c)}function g(...e){if(e.length===0)return g(0,0);if(e.length===1){if(typeof e[0]=="number")return g(e[0],e[0]);if(Be(e[0]))return g(e[0].x,e[0].y);if(Array.isArray(e[0])&&e[0].length===2)return g.apply(null,e[0])}return{x:e[0],y:e[1],clone(){return g(this.x,this.y)},add(...t){let a=g(...t);return g(this.x+a.x,this.y+a.y)},sub(...t){let a=g(...t);return g(this.x-a.x,this.y-a.y)},scale(t){return g(this.x*t,this.y*t)},dist(...t){let a=g(...t);return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))},len(){return this.dist(g(0,0))},unit(){return this.scale(1/this.len())},normal(){return g(this.y,-this.x)},dot(...t){let a=g(...t);return g(this.x*a.x,this.y*a.y)},angle(...t){let a=g(...t);return Math.atan2(this.y-a.y,this.x-a.x)},lerp(t,a){return g(ze(this.x,t.x,a),ze(this.y,t.y,a))},eq(t){return this.x===t.x&&this.y===t.y},str(){return`(${this.x}, ${this.y})`}}}function rr(e){return g(Math.cos(e),Math.sin(e))}function Le(e,t,a){return{x:e,y:t,z:a,xy(){return g(this.x,this.y)}}}function Be(e){return e!==void 0&&e.x!==void 0&&e.y!==void 0}function nr(e){return e!==void 0&&e.x!==void 0&&e.y!==void 0&&e.z!==void 0}function Ee(e){return e!==void 0&&e.r!==void 0&&e.g!==void 0&&e.b!==void 0&&e.a!==void 0}function or(e){if(e!==void 0&&Array.isArray(e.m)&&e.m.length===16)return e}function st(...e){if(e.length===0)return Z();if(e.length===1){if(Ee(e[0]))return Z(e[0]);if(Array.isArray(e[0])&&e[0].length===3)return st.apply(null,e[0])}return Z(e[0],e[1],e[2],1)}function Z(...e){var t;if(e.length===0)return Z(1,1,1,1);if(e.length===1){if(Ee(e[0]))return Z(e[0].r,e[0].g,e[0].b,e[0].a);if(Array.isArray(e[0])&&e[0].length===4)return Z.apply(null,e[0])}return{r:e[0],g:e[1],b:e[2],a:(t=e[3])!=null?t:1,clone(){return Z(this.r,this.g,this.b,this.a)},lighten(a){return Z(this.r+a,this.g+a,this.b+a,this.a)},darken(a){return this.lighten(-a)},invert(){return Z(1-this.r,1-this.g,1-this.b,this.a)},isDark(a=.5){return this.r+this.g+this.b<3*a},isLight(a=.5){return this.r+this.g+this.b>3*a},eq(a){return this.r===a.r&&this.g===a.g&&this.b===a.g&&this.a===a.a}}}function ye(e,t,a,r){return{x:e,y:t,w:a,h:r,clone(){return ye(this.x,this.y,this.w,this.h)},eq(c){return this.x===c.x&&this.y===c.y&&this.w===c.w&&this.h===c.h}}}function se(e){return{m:e?[...e]:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],clone(){return se(this.m)},mult(t){let a=[];for(let r=0;r<4;r++)for(let c=0;c<4;c++)a[r*4+c]=this.m[0*4+c]*t.m[r*4+0]+this.m[1*4+c]*t.m[r*4+1]+this.m[2*4+c]*t.m[r*4+2]+this.m[3*4+c]*t.m[r*4+3];return se(a)},multVec4(t){return{x:t.x*this.m[0]+t.y*this.m[4]+t.z*this.m[8]+t.w*this.m[12],y:t.x*this.m[1]+t.y*this.m[5]+t.z*this.m[9]+t.w*this.m[13],z:t.x*this.m[2]+t.y*this.m[6]+t.z*this.m[10]+t.w*this.m[14],w:t.x*this.m[3]+t.y*this.m[7]+t.z*this.m[11]+t.w*this.m[15]}},multVec3(t){let a=this.multVec4({x:t.x,y:t.y,z:t.z,w:1});return Le(a.x,a.y,a.z)},multVec2(t){return g(t.x*this.m[0]+t.y*this.m[4]+0*this.m[8]+1*this.m[12],t.x*this.m[1]+t.y*this.m[5]+0*this.m[9]+1*this.m[13])},translate(t){return this.mult(se([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1]))},scale(t){return this.mult(se([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1]))},rotateX(t){return this.mult(se([1,0,0,0,0,Math.cos(t),-Math.sin(t),0,0,Math.sin(t),Math.cos(t),0,0,0,0,1]))},rotateY(t){return this.mult(se([Math.cos(t),0,-Math.sin(t),0,0,1,0,0,Math.sin(t),0,Math.cos(t),0,0,0,0,1]))},rotateZ(t){return this.mult(se([Math.cos(t),-Math.sin(t),0,0,Math.sin(t),Math.cos(t),0,0,0,0,1,0,0,0,0,1]))},invert(){let t=[],a=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],c=this.m[9]*this.m[14]-this.m[13]*this.m[10],E=this.m[8]*this.m[15]-this.m[12]*this.m[11],w=this.m[8]*this.m[14]-this.m[12]*this.m[10],A=this.m[8]*this.m[13]-this.m[12]*this.m[9],m=this.m[6]*this.m[15]-this.m[14]*this.m[7],v=this.m[5]*this.m[15]-this.m[13]*this.m[7],B=this.m[5]*this.m[14]-this.m[13]*this.m[6],k=this.m[4]*this.m[15]-this.m[12]*this.m[7],D=this.m[4]*this.m[14]-this.m[12]*this.m[6],f=this.m[5]*this.m[15]-this.m[13]*this.m[7],b=this.m[4]*this.m[13]-this.m[12]*this.m[5],M=this.m[6]*this.m[11]-this.m[10]*this.m[7],F=this.m[5]*this.m[11]-this.m[9]*this.m[7],X=this.m[5]*this.m[10]-this.m[9]*this.m[6],q=this.m[4]*this.m[11]-this.m[8]*this.m[7],_=this.m[4]*this.m[10]-this.m[8]*this.m[6],j=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*a-this.m[6]*r+this.m[7]*c,t[4]=-(this.m[4]*a-this.m[6]*E+this.m[7]*w),t[8]=this.m[4]*r-this.m[5]*E+this.m[7]*A,t[12]=-(this.m[4]*c-this.m[5]*w+this.m[6]*A),t[1]=-(this.m[1]*a-this.m[2]*r+this.m[3]*c),t[5]=this.m[0]*a-this.m[2]*E+this.m[3]*w,t[9]=-(this.m[0]*r-this.m[1]*E+this.m[3]*A),t[13]=this.m[0]*c-this.m[1]*w+this.m[2]*A,t[2]=this.m[1]*m-this.m[2]*v+this.m[3]*B,t[6]=-(this.m[0]*m-this.m[2]*k+this.m[3]*D),t[10]=this.m[0]*f-this.m[1]*k+this.m[3]*b,t[14]=-(this.m[0]*B-this.m[1]*D+this.m[2]*b),t[3]=-(this.m[1]*M-this.m[2]*F+this.m[3]*X),t[7]=this.m[0]*M-this.m[2]*q+this.m[3]*_,t[11]=-(this.m[0]*F-this.m[1]*q+this.m[3]*j),t[15]=this.m[0]*X-this.m[1]*_+this.m[2]*j;let R=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let l=0;l<4;l++)for(let Y=0;Y<4;Y++)t[l*4+Y]*=1/R;return se(t)}}}function ir(e,t,a){return e+(Math.sin(a)+1)/2*(t-e)}function yt(e){return{seed:e,gen(...t){if(t.length===0)return this.seed=(sr*this.seed+ar)%gt,this.seed/gt;if(t.length===1){if(typeof t[0]=="number")return this.gen(0,t[0]);if(Be(t[0]))return this.gen(g(0,0),t[0]);if(Ee(t[0]))return this.gen(Z(0,0,0,0),t[0])}else if(t.length===2){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.gen()*(t[1]-t[0])+t[0];if(Be(t[0])&&Be(t[1]))return g(this.gen(t[0].x,t[1].x),this.gen(t[0].y,t[1].y));if(Ee(t[0])&&Ee(t[1]))return Z(this.gen(t[0].r,t[1].r),this.gen(t[0].g,t[1].g),this.gen(t[0].b,t[1].b),this.gen(t[0].a,t[1].a))}}}}function lr(e){wt.seed=e}function Ke(...e){return wt.gen(...e)}function ur(e){return Ke()<=e}function cr(e){return e[Math.floor(Ke(e.length))]}function vt(e,t){return e.p2.x>=t.p1.x&&e.p1.x<=t.p2.x&&e.p2.y>=t.p1.y&&e.p1.y<=t.p2.y}function dr(e,t){return e.p2.x>t.p1.x&&e.p1.x<t.p2.x&&e.p2.y>t.p1.y&&e.p1.y<t.p2.y}function hr(e,t){return t.x>=e.p1.x&&t.x<=e.p2.x&&t.y>=e.p1.y&&t.y<e.p2.y}var sr,ar,gt,wt,Ce=me(()=>{s(Zt,"deg2rad"),s(er,"rad2deg"),s(ge,"clamp"),s(ze,"lerp"),s(Je,"map"),s(tr,"mapc"),s(g,"vec2"),s(rr,"vec2FromAngle"),s(Le,"vec3"),s(Be,"isVec2"),s(nr,"isVec3"),s(Ee,"isColor"),s(or,"isMat4"),s(st,"rgb"),s(Z,"rgba"),s(ye,"quad"),s(se,"mat4"),s(ir,"wave"),sr=1103515245,ar=12345,gt=2147483648,wt=yt(Date.now()),s(yt,"makeRng"),s(lr,"randSeed"),s(Ke,"rand"),s(ur,"chance"),s(cr,"choose"),s(vt,"colRectRect"),s(dr,"overlapRectRect"),s(hr,"colRectPt")});function xt(e,t){let a=typeof e,r=typeof t;if(a!==r)return!1;if(a==="object"&&r==="object"){let c=Object.keys(e),E=Object.keys(t);if(c.length!==E.length)return!1;for(let w of c){let A=e[w],m=t[w];if(!(typeof A=="function"&&typeof m=="function")&&!xt(A,m))return!1}return!0}return e===t}var Wr=me(()=>{s(xt,"deepEq")});function We(e){switch(e){case"topleft":return g(-1,-1);case"top":return g(0,-1);case"topright":return g(1,-1);case"left":return g(-1,0);case"center":return g(0,0);case"right":return g(1,0);case"botleft":return g(-1,1);case"bot":return g(0,1);case"botright":return g(1,1);default:return e}}function mr(e,t){let a=(()=>{switch(t.texFilter){case"linear":return e.LINEAR;case"nearest":return e.NEAREST;default:return e.NEAREST}})(),r=(()=>{var y;let T=w(lt,ut),P=E(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),L=(y=t.clearColor)!=null?y:Z(0,0,0,1);e.clearColor(L.r,L.g,L.b,L.a),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);let G=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,G),e.bufferData(e.ARRAY_BUFFER,$e*4,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null);let J=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,J),e.bufferData(e.ELEMENT_ARRAY_BUFFER,$e*2,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);let ee=E(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2));return{drawCalls:0,lastDrawCalls:0,defProg:T,curProg:T,defTex:P,curTex:P,curUniform:{},vbuf:G,ibuf:J,vqueue:[],iqueue:[],transform:se(),transformStack:[],clearColor:L,bgTex:ee}})();B(),k();function c(y){return Math.log(y)/Math.log(2)%1==0}s(c,"powerOfTwo");function E(y){let T=e.createTexture();e.bindTexture(e.TEXTURE_2D,T),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,y),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a);let P=(()=>c(y.width)&&c(y.height)?e.REPEAT:e.CLAMP_TO_EDGE)();return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,P),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,P),e.bindTexture(e.TEXTURE_2D,null),{width:y.width,height:y.height,bind(){e.bindTexture(e.TEXTURE_2D,T)},unbind(){e.bindTexture(e.TEXTURE_2D,null)}}}s(E,"makeTex");function w(y=lt,T=ut){let P,L=fr.replace("{{user}}",y??lt),G=pr.replace("{{user}}",T??ut),J=e.createShader(e.VERTEX_SHADER),ee=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(J,L),e.shaderSource(ee,G),e.compileShader(J),e.compileShader(ee),P=e.getShaderInfoLog(J))throw new Error(P);if(P=e.getShaderInfoLog(ee))throw new Error(P);let C=e.createProgram();if(e.attachShader(C,J),e.attachShader(C,ee),e.bindAttribLocation(C,0,"a_pos"),e.bindAttribLocation(C,1,"a_uv"),e.bindAttribLocation(C,2,"a_color"),e.linkProgram(C),(P=e.getProgramInfoLog(C))&&P!==`
`)throw new Error(P);return{bind(){e.useProgram(C)},unbind(){e.useProgram(null)},bindAttribs(){e.vertexAttribPointer(0,3,e.FLOAT,!1,ke*4,0),e.enableVertexAttribArray(0),e.vertexAttribPointer(1,2,e.FLOAT,!1,ke*4,12),e.enableVertexAttribArray(1),e.vertexAttribPointer(2,4,e.FLOAT,!1,ke*4,20),e.enableVertexAttribArray(2)},send($){this.bind();for(let z in $){let U=$[z],W=e.getUniformLocation(C,z);typeof U=="number"?e.uniform1f(W,U):or(U)?e.uniformMatrix4fv(W,!1,new Float32Array(U.m)):Ee(U)?e.uniform4f(W,U.r,U.g,U.b,U.a):nr(U)?e.uniform3f(W,U.x,U.y,U.z):Be(U)&&e.uniform2f(W,U.x,U.y)}this.unbind()}}}s(w,"makeProgram");function A(y,T,P,L){let G=y.width/T,J=y.height/P,ee=1/G,C=1/J,$={},z=L.split("").entries();for(let[U,W]of z)$[W]=g(U%G*ee,Math.floor(U/G)*C);return{tex:y,map:$,qw:ee,qh:C}}s(A,"makeFont");function m(y,T,P=r.defTex,L=r.defProg,G={}){P=P??r.defTex,L=L??r.defProg,(P!==r.curTex||L!==r.curProg||!xt(r.curUniform,G)||r.vqueue.length+y.length*ke>$e||r.iqueue.length+T.length>$e)&&v(),r.curTex=P,r.curProg=L,r.curUniform=G;let J=T.map(C=>C+r.vqueue.length/ke),ee=y.map(C=>{let $=f(r.transform.multVec2(C.pos.xy()));return[$.x,$.y,C.pos.z,C.uv.x,C.uv.y,C.color.r,C.color.g,C.color.b,C.color.a]}).flat();J.forEach(C=>r.iqueue.push(C)),ee.forEach(C=>r.vqueue.push(C))}s(m,"drawRaw");function v(){!r.curTex||!r.curProg||r.vqueue.length===0||r.iqueue.length===0||(r.curProg.send(r.curUniform),e.bindBuffer(e.ARRAY_BUFFER,r.vbuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(r.vqueue)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.ibuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(r.iqueue)),r.curProg.bind(),r.curProg.bindAttribs(),r.curTex.bind(),e.drawElements(e.TRIANGLES,r.iqueue.length,e.UNSIGNED_SHORT,0),r.curTex.unbind(),r.curProg.unbind(),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),r.iqueue=[],r.vqueue=[],r.drawCalls++)}s(v,"flush");function B(){e.clear(e.COLOR_BUFFER_BIT),t.clearColor||l({width:de(),height:ve(),quad:ye(0,0,de()*fe()/St,ve()*fe()/St),tex:r.bgTex}),r.drawCalls=0,r.transformStack=[],r.transform=se()}s(B,"frameStart");function k(){v(),r.lastDrawCalls=r.drawCalls}s(k,"frameEnd");function D(){return r.lastDrawCalls}s(D,"drawCalls");function f(y){return g(y.x/de()*2-1,-y.y/ve()*2+1)}s(f,"toNDC");function b(y){r.transform=y.clone()}s(b,"pushMatrix");function M(y){!y||y.x===0&&y.y===0||(r.transform=r.transform.translate(y))}s(M,"pushTranslate");function F(y){!y||y.x===1&&y.y===1||(r.transform=r.transform.scale(y))}s(F,"pushScale");function X(y){!y||(r.transform=r.transform.rotateX(y))}s(X,"pushRotateX");function q(y){!y||(r.transform=r.transform.rotateY(y))}s(q,"pushRotateY");function _(y){!y||(r.transform=r.transform.rotateZ(y))}s(_,"pushRotateZ");function j(){r.transformStack.push(r.transform.clone())}s(j,"pushTransform");function R(){r.transformStack.length>0&&(r.transform=r.transformStack.pop())}s(R,"popTransform");function l(y={}){var T,P;let L=y.width||0,G=y.height||0,J=y.pos||g(0,0),ee=We(y.origin||at).dot(g(L,G).scale(-.5)),C=g((T=y.scale)!=null?T:1),$=y.rot||0,z=y.quad||ye(0,0,1,1),U=1-((P=y.z)!=null?P:0),W=y.color||Z(1,1,1,1);j(),M(J),F(C),_($),M(ee),m([{pos:Le(-L/2,G/2,U),uv:g(z.x,z.y+z.h),color:W},{pos:Le(-L/2,-G/2,U),uv:g(z.x,z.y),color:W},{pos:Le(L/2,-G/2,U),uv:g(z.x+z.w,z.y),color:W},{pos:Le(L/2,G/2,U),uv:g(z.x+z.w,z.y+z.h),color:W}],[0,1,3,1,2,3],y.tex,y.prog,y.uniform),R()}s(l,"drawQuad");function Y(y,T={}){var P;let L=(P=T.quad)!=null?P:ye(0,0,1,1),G=y.width*L.w,J=y.height*L.h;l(it(Oe({},T),{tex:y,quad:L,width:G,height:J}))}s(Y,"drawTexture");function I(y,T,P,L={}){l(it(Oe({},L),{pos:y,width:T,height:P}))}s(I,"drawRect");function N(y,T,P,L={}){let G=We(L.origin||at).dot(g(T,P)).scale(.5),J=y.add(g(-T/2,-P/2)).sub(G),ee=y.add(g(-T/2,P/2)).sub(G),C=y.add(g(T/2,P/2)).sub(G),$=y.add(g(T/2,-P/2)).sub(G);re(J,ee,L),re(ee,C,L),re(C,$,L),re($,J,L)}s(N,"drawRectStroke");function re(y,T,P={}){let L=P.width||1,G=y.dist(T),J=Math.PI/2-y.angle(T);l(it(Oe({},P),{pos:y.add(T).scale(.5),width:L,height:G,rot:J,origin:"center"}))}s(re,"drawLine");function ie(y,T,P={}){let L=(y+"").split(""),G=T.qw*T.tex.width,J=T.qh*T.tex.height,ee=P.size||J,C=g(ee/J).dot(g(P.scale||1)),$=C.x*G,z=C.y*J,U=0,W=z,pe=0,be=[[]];for(let ne of L)(ne===`
`||(P.width?U+$>P.width:!1))&&(W+=z,U=0,be.push([])),ne!==`
`&&(be[be.length-1].push(ne),U+=$),pe=Math.max(pe,U);P.width&&(pe=P.width);let Ue=[],Xe=g(P.pos||0),xe=We(P.origin||at).scale(.5),tt=-xe.x*$-(xe.x+.5)*(pe-$),Se=-xe.y*z-(xe.y+.5)*(W-z);return be.forEach((ne,Fe)=>{let _e=(pe-ne.length*$)*(xe.x+.5);ne.forEach((qe,je)=>{let Re=T.map[qe],rt=je*$,nt=Fe*z;Re&&Ue.push({tex:T.tex,quad:ye(Re.x,Re.y,T.qw,T.qh),ch:qe,pos:g(Xe.x+rt+tt+_e,Xe.y+nt+Se),color:P.color,origin:P.origin,scale:C,z:P.z})})}),{width:pe,height:W,chars:Ue}}s(ie,"fmtText");function ae(y,T,P={}){le(ie(y,T,P))}s(ae,"drawText");function le(y){for(let T of y.chars)l({tex:T.tex,width:T.tex.width*T.quad.w,height:T.tex.height*T.quad.h,pos:T.pos,scale:T.scale,color:T.color,quad:T.quad,origin:"center",z:T.z})}s(le,"drawFmtText");function de(){return e.drawingBufferWidth/fe()}s(de,"width");function ve(){return e.drawingBufferHeight/fe()}s(ve,"height");function fe(){var y;return(y=t.scale)!=null?y:1}s(fe,"scale");function De(){return r.clearColor.clone()}return s(De,"clearColor"),{width:de,height:ve,scale:fe,makeTex:E,makeProgram:w,makeFont:A,drawTexture:Y,drawText:ae,drawFmtText:le,drawRect:I,drawRectStroke:N,drawLine:re,fmtText:ie,frameStart:B,frameEnd:k,pushTransform:j,popTransform:R,pushMatrix:b,drawCalls:D,clearColor:De}}var at,ke,$e,St,fr,pr,lt,ut,$r=me(()=>{Ce(),Wr(),at="topleft",ke=9,$e=65536,St=64,fr=`
attribute vec3 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec3 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,pr=`
precision mediump float;

varying vec3 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,lt=`
vec4 vert(vec3 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,ut=`
vec4 frag(vec3 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,s(We,"originPt"),s(mr,"gfxInit")});function At(e){return e==="pressed"||e==="rpressed"?"down":e==="released"?"up":e}function gr(e={}){var t,a;let r={canvas:(t=e.canvas)!=null?t:(()=>{var I;let N=document.createElement("canvas");return((I=e.root)!=null?I:document.body).appendChild(N),N})(),keyStates:{},charInputted:[],mouseState:"up",mousePos:g(0,0),time:0,realTime:0,skipTime:!1,dt:0,scale:(a=e.scale)!=null?a:1,isTouch:!1,loopID:null,stopped:!1,fps:0,fpsBuf:[],fpsTimer:0},c={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"},E=["space","left","right","up","down","tab","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11"];e.fullscreen?(r.canvas.width=window.innerWidth,r.canvas.height=window.innerHeight):(r.canvas.width=(e.width||640)*r.scale,r.canvas.height=(e.height||480)*r.scale);let w=["outline: none","cursor: default"];e.crisp&&(w.push("image-rendering: pixelated"),w.push("image-rendering: crisp-edges")),r.canvas.style=w.join(";"),r.canvas.setAttribute("tabindex","0");let A=r.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});r.isTouch="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,r.canvas.addEventListener("mousemove",I=>{r.mousePos=g(I.offsetX,I.offsetY).scale(1/r.scale)}),r.canvas.addEventListener("mousedown",()=>{r.mouseState="pressed"}),r.canvas.addEventListener("mouseup",()=>{r.mouseState="released"}),r.canvas.addEventListener("touchstart",I=>{let N=I.touches[0];r.mousePos=g(N.clientX,N.clientY).scale(1/r.scale),r.mouseState="pressed"}),r.canvas.addEventListener("touchmove",I=>{let N=I.touches[0];r.mousePos=g(N.clientX,N.clientY).scale(1/r.scale)}),r.canvas.addEventListener("keydown",I=>{let N=c[I.key]||I.key.toLowerCase();E.includes(N)&&I.preventDefault(),N.length===1&&r.charInputted.push(N),N==="space"&&r.charInputted.push(" "),I.repeat?r.keyStates[N]="rpressed":r.keyStates[N]="pressed"}),r.canvas.addEventListener("keyup",I=>{let N=c[I.key]||I.key.toLowerCase();r.keyStates[N]="released"}),r.canvas.focus(),document.addEventListener("visibilitychange",()=>{switch(document.visibilityState){case"visible":r.skipTime=!0;break;case"hidden":break}});function m(){return r.mousePos.clone()}s(m,"mousePos");function v(){return r.mouseState==="pressed"}s(v,"mouseClicked");function B(){return r.mouseState==="pressed"||r.mouseState==="down"}s(B,"mouseDown");function k(){return r.mouseState==="released"}s(k,"mouseReleased");function D(I){return r.keyStates[I]==="pressed"}s(D,"keyPressed");function f(I){return r.keyStates[I]==="pressed"||r.keyStates[I]==="rpressed"}s(f,"keyPressedRep");function b(I){return r.keyStates[I]==="pressed"||r.keyStates[I]==="rpressed"||r.keyStates[I]==="down"}s(b,"keyDown");function M(I){return r.keyStates[I]==="released"}s(M,"keyReleased");function F(){return[...r.charInputted]}s(F,"charInputted");function X(){return r.dt}s(X,"dt");function q(){return r.time}s(q,"time");function _(){return r.fps}s(_,"fps");function j(){return r.canvas.toDataURL()}s(j,"screenshot");function R(I){return I&&(r.canvas.style.cursor=I??"default"),r.canvas.style.cursor}s(R,"cursor");function l(I){let N=s(re=>{let ie=re/1e3,ae=ie-r.realTime;r.realTime=ie,r.skipTime||(r.dt=ae,r.time+=r.dt,r.fpsBuf.push(1/r.dt),r.fpsTimer+=r.dt,r.fpsTimer>=1&&(r.fpsTimer=0,r.fps=Math.round(r.fpsBuf.reduce((le,de)=>le+de)/r.fpsBuf.length),r.fpsBuf=[])),r.skipTime=!1,I();for(let le in r.keyStates)r.keyStates[le]=At(r.keyStates[le]);r.mouseState=At(r.mouseState),r.charInputted=[],r.stopped||(r.loopID=requestAnimationFrame(N))},"frame");r.loopID=requestAnimationFrame(N)}s(l,"run");function Y(){cancelAnimationFrame(r.loopID),r.stopped=!0}return s(Y,"quit"),{gl:A,mousePos:m,keyDown:b,keyPressed:D,keyPressedRep:f,keyReleased:M,mouseDown:B,mouseClicked:v,mouseReleased:k,charInputted:F,cursor:R,dt:X,time:q,fps:_,screenshot:j,run:l,quit:Y}}var Qr=me(()=>{Ce(),s(At,"processBtnState"),s(gr,"appInit")});function Sr(){let e=(()=>{let c=new(window.AudioContext||window.webkitAudioContext),E=c.createGain(),w=E;return w.connect(c.destination),{ctx:c,gainNode:E,masterNode:w}})();function t(c){return c!==void 0&&(e.gainNode.gain.value=ge(c,bt,Rt)),e.gainNode.gain.value}s(t,"volume");function a(c,E={loop:!1,volume:1,speed:1,detune:0,seek:0}){var w;let A=!1,m=e.ctx.createBufferSource();m.buffer=c,m.loop=!!E.loop;let v=e.ctx.createGain();m.connect(v),v.connect(e.masterNode);let B=(w=E.seek)!=null?w:0;m.start(0,B);let k=e.ctx.currentTime-B,D=null,f={stop(){A||(this.pause(),k=e.ctx.currentTime)},play(b){if(!A)return;let M=m;m=e.ctx.createBufferSource(),m.buffer=M.buffer,m.loop=M.loop,m.playbackRate.value=M.playbackRate.value,m.detune&&(m.detune.value=M.detune.value),m.connect(v);let F=b??this.time();m.start(0,F),k=e.ctx.currentTime-F,A=!1,D=null},pause(){A||(m.stop(),A=!0,D=e.ctx.currentTime)},paused(){return A},stopped(){return A},speed(b){return b!==void 0&&(m.playbackRate.value=ge(b,yr,wr)),m.playbackRate.value},detune(b){return m.detune?(b!==void 0&&(m.detune.value=ge(b,vr,xr)),m.detune.value):0},volume(b){return b!==void 0&&(v.gain.value=ge(b,bt,Rt)),v.gain.value},loop(){m.loop=!0},unloop(){m.loop=!1},duration(){return c.duration},time(){return A?D-k:e.ctx.currentTime-k}};return f.speed(E.speed),f.detune(E.detune),f.volume(E.volume),f}s(a,"play");function r(){return e.ctx}return s(r,"ctx"),{ctx:r,volume:t,play:a}}var bt,Rt,yr,wr,vr,xr,Zr=me(()=>{Ce(),bt=0,Rt=3,yr=0,wr=3,vr=-1200,xr=1200,s(Sr,"audioInit")}),Ar,en=me(()=>{Ar="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvgAAAAICAYAAACML4vTAAAAAXNSR0IArs4c6QAABo1JREFUeJzdW9uO5SgMJKv9/1/OPnQnDabKVQb6zGgtjeYkvmJsYwh9tQLc931//7yu63retdba+/4hTZ6ZDMQ3wHVdPe1kXk/60He2D/J7HLMhGyOwHQKji/o/BYmv40DecRq+cfgr8l8dhBfRLPF3v6F9Cu/ObwFPYxRBFptE7mA/wQ2yWMwI/1r+y3Bq/h4H3TwJ3fl16xcz4UfQPB+oplF9QJ7id+SjMVjz/wf5e5rK+hKfB9+a86PsZTIm+7P6942jufsqSvg7/END5WSg6ojLt7uurcjL6v8pfQ4doinIL9v+f4HTMfQ3gopR5gOQ+6jviPj7EfLvqQGsQFiXb/B7KMBGc/rQ3x1ONuHmBmOQfd93XwDVguPI/3Uw/fc8Dz5s4/xMogU/xScNKILJb4W5Q/YyXtt+IWcyF+GzMajY7ehZbCK5vf2sGczmJ+J6O6J8pT8dB5HPwPU706/knsjfVRlxvhje0Zn5H+F/m/+kf6uA1oxqPVD1Jeqj+kHuRr5x0ZzzU8nJANrCalDS5A54xV9Ynyd+p/6bNXSiBfY5Dk1pkPyObzI0s10ceFr+3+FXsMq/qk+BM97TusU6bIvp+Flf1ufuy/OJBh817s/vlcKOaOHgRBOeyu0nppt4uIEA+gcboLLv96oIu18IFLhfSRooMh19hsvkKyNjkCo6R+fXC3ya/ddAdjrekxH2i8VmiH23oGTNYy+n2iBHyPhYjtWV8IJtyz38BW6a42JMKuJtn30IfgJT+PdkziayaP1W+OpX6J6HyJ+ac8MXaJEvNfnGGheVow34neAn/tag30aByRfI5PDBlZ9tzNghHuJDMnZpGO37rMam/L/Jj2w6wY/8TH1gPCNfQ3zxAJTZ3wPKkS9EIS9bm3OfbDonof9YWgw7gCJ0uqF+390/JIs1QZE+yhjkKOcifMKDdMX3kYbxKB3xn8fsNZEPPm2SBQ7KD/OkkgXZfYV/PV/U/+rok0IswDH+HDyCmAcuXs1LHP8gBzTyd487dIrgAPPfC489wK6K/GwjouYoo6nmZQXUHCtA9RThd+yX87fIn9X3T8Kkl2yC3zlS+NZK9XUClruFjU3093IcBFui8U79Zfg74Flj7dRHJJ/1Hq58xAs3JAdgNb9QDxHB9f8JfgSV+c96QaVnCcRhzx3+r+hXY9qtq1HmKy+up3Ft3T7BN06gWVDGZhI5JL4b6Mh9yolu5T6iukMN7M4KQqWZ/SKYP9+lYJyAOYtPveMy5IPdZja//XPVnkw+tBHdPe35w8kWs3UX+tjNrtggvpWvM3H8Lihi5f/dE1kVD068PL7O+Fc2z65eNseuDEfHKoxFpx4fjm9bS+LjFyEu4F8P4gras1geqq8QzK9wlJ3IWYJk3TtS8zbvV8MN2qGvaxQOXt3YafKe2NjN8U8A2hzGDQpdg37xqzurObB3dOY9uyYG8nG37pXjp9rg7wQm+v0A201GvGqUd4KfFlejgUobxCDjixAXod3NiWVfRaa6YsT0hitIWWAqXyr+JdhYBDJbSg32Y8fOFZvVDdziBq/cABPY8WEKpxf31fgnMM2xq681u9HYagAM/6mxDmM0eXaBNhCELgKt36Z+Vf9GYoDLrsg496TZ8yFg629dEL+D7sDq4FB8bIF7xTaxI2X8Q9dJWf7Y/ks2iPYGf2HsWf5HnOovUH2m4896Q9JDDs+rV7TduKs2+EcLNdnhvM/f+MqCEp8tO437h9C2YEP2nL7/5WR2G79sgYwGqo1ElJHu4F9msAkC84Lscxd4Bg5/ansGhVOAKf7MAuBu4NC8seJ1mQ0lku/okM090M/iS8HuAq/ivxJ/To1RMrDg/G8OTuVHub4e1j/wg9xBuF5fbPJVTlTsdOaPrmdiHVqK3UN/w+Xmz2r+K/mQf6G5RnauwDuHm80oGwCLkZMbHLYB/nkYm9Md/yF6NDa3SR9sNPM/0rD+cpgf8ws+qifOGN35XK2bHznBj3xWEKHTy+QT5HYiGJ83kW3lP5ZI4MTmKU1a9rcFbNyFT76OzVC+olP2tQYLEJNfGmO2iVs4AU/nd/PzejrHiM58z/BWvjnzs+J7QEvxzlcQgFupJxXfVuSjuFP11NFp4bI76IVnpZ/a7cxfRkNiIxtL9n41f1yayhrngmrG5LwYdWkp/x35h9Yg1WC6vlYNuStvKeZW+h9zfR/eIboHxD12Bml87PYgiCZZP5Z81fI5lrm5k0fxfWVj+x9lSgjp7YOOoAAAAABJRU5ErkJggg=="});function Et(e){let t=new Image;return t.src=e,t.crossOrigin="anonymous",new Promise((a,r)=>{t.onload=()=>{a(t)},t.onerror=()=>{r(`failed to load ${e}`)}})}function Tt(e){return e.startsWith("data:")}function Rr(e,t,a={}){let r={lastLoaderID:0,loadRoot:"",loaders:{},sprites:{},sounds:{},fonts:{},shaders:{}};function c(D){var f;let b=r.lastLoaderID;r.loaders[b]=!1,r.lastLoaderID++,D.catch((f=a.errHandler)!=null?f:console.error).finally(()=>{r.loaders[b]=!0})}s(c,"addLoader");function E(){let D=0,f=0;for(let b in r.loaders)D+=1,r.loaders[b]&&(f+=1);return f/D}s(E,"loadProgress");function w(D){return D&&(r.loadRoot=D),r.loadRoot}s(w,"loadRoot");function A(D,f,b,M,F=br){let X=new Promise((q,_)=>{let j=Tt(f)?f:r.loadRoot+f;Et(j).then(R=>{let l=e.makeFont(e.makeTex(R),b,M,F);r.fonts[D]=l,q(l)}).catch(_)});return c(X),X}s(A,"loadFont");function m(D,f,b={sliceX:1,sliceY:1,anims:{}}){function M(X,q,_={sliceX:1,sliceY:1,gridWidth:0,gridHeight:0,anims:{}}){let j=[],R=e.makeTex(q),l=_.sliceX||R.width/(_.gridWidth||R.width),Y=_.sliceY||R.height/(_.gridHeight||R.height),I=1/l,N=1/Y;for(let ie=0;ie<Y;ie++)for(let ae=0;ae<l;ae++)j.push(ye(ae*I,ie*N,I,N));let re={tex:R,frames:j,anims:_.anims||{}};return r.sprites[X]=re,re}s(M,"loadRawSprite");let F=new Promise((X,q)=>{if(!f)return q(`expected sprite src for "${D}"`);if(typeof f=="string"){let _=Tt(f)?f:r.loadRoot+f;Et(_).then(j=>{X(M(D,j,b))}).catch(q)}else X(M(D,f,b))});return c(F),F}s(m,"loadSprite");function v(D,f,b,M=!1){function F(q,_,j){let R=e.makeProgram(_,j);return r.shaders[q]=R,R}s(F,"loadRawShader");let X=new Promise((q,_)=>{if(!f&&!b)return _("no shader");function j(R){return R?fetch(r.loadRoot+R).then(l=>{if(l.ok)return l.text();throw new Error(`failed to load ${R}`)}).catch(_):new Promise(l=>l(null))}if(s(j,"resolveUrl"),M)Promise.all([j(f),j(b)]).then(([R,l])=>{q(F(D,R,l))}).catch(_);else try{q(F(D,f,b))}catch(R){_(R)}});return c(X),X}s(v,"loadShader");function B(D,f){let b=r.loadRoot+f,M=new Promise((F,X)=>{if(!f)return X(`expected sound src for "${D}"`);typeof f=="string"&&fetch(b).then(q=>{if(q.ok)return q.arrayBuffer();throw new Error(`failed to load ${b}`)}).then(q=>new Promise((_,j)=>{t.ctx().decodeAudioData(q,_,j)})).then(q=>{r.sounds[D]=q,F(q)}).catch(X)});return c(M),M}s(B,"loadSound");function k(){return r.fonts[Ye]}return s(k,"defFont"),A(Ye,Ar,8,8),{loadRoot:w,loadSprite:m,loadSound:B,loadFont:A,loadShader:v,loadProgress:E,addLoader:c,defFont:k,sprites:r.sprites,fonts:r.fonts,sounds:r.sounds,shaders:r.shaders}}var br,Ye,tn=me(()=>{Ce(),en(),br=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Ye="unscii",s(Et,"loadImg"),s(Tt,"isDataUrl"),s(Rr,"assetsInit")});function Tr(e,t,a={max:8}){var r;let c=[],E=(r=a.max)!=null?r:8;function w(){c.length>E&&(c=c.slice(0,E));let B=g(0,e.height());c.forEach((k,D)=>{let f=Je(D,0,E,1,.5),b=Je(D,0,E,.8,.2),M=(()=>{switch(k.type){case"info":return Z(1,1,1,f);case"error":return Z(1,0,.5,f)}})(),F=e.fmtText(k.msg,t.defFont(),{pos:B,origin:"botleft",color:M,size:Er/e.scale(),width:e.width()});e.drawRect(B,F.width,F.height,{origin:"botleft",color:Z(0,0,0,b)}),e.drawFmtText(F),B.y-=F.height})}s(w,"draw");function A(B){console.error(B),c.unshift({type:"error",msg:B})}s(A,"error");function m(B){c.unshift({type:"info",msg:B})}s(m,"info");function v(){c=[]}return s(v,"clear"),{info:m,error:A,draw:w,clear:v}}var Er,rn=me(()=>{Ce(),Er=16,s(Tr,"loggerInit")});function Pr(e){let t={},a=[],r=null;function c(){return r!==null&&r.readyState===1}s(c,"connected");function E(){let v=new WebSocket(e);return new Promise((B,k)=>{v.onopen=()=>{B(v),r=v;for(let D of a)v.send(D)},v.onerror=()=>{k(`failed to connect to ${e}`)},v.onmessage=D=>{let f=JSON.parse(D.data);if(t[f.type])for(let b of t[f.type])b(f.data,f.id)}})}s(E,"connect");function w(v,B){t[v]||(t[v]=[]),t[v].push(B)}s(w,"recv");function A(v,B){let k=JSON.stringify({type:v,data:B});r?r.send(k):a.push(k)}s(A,"send");function m(){r&&r.close()}return s(m,"close"),{connect:E,close:m,connected:c,recv:w,send:A}}var nn=me(()=>{s(Pr,"netInit")}),on=Kr((e,t)=>{Ce(),$r(),Qr(),Zr(),tn(),rn(),nn(),t.exports=(a={width:640,height:480,scale:1,fullscreen:!1,debug:!1,crisp:!1,canvas:null,connect:null,logMax:8,root:document.body})=>{let r=gr({width:a.width,height:a.height,scale:a.scale,fullscreen:a.fullscreen,crisp:a.crisp,canvas:a.canvas,root:a.root}),c=mr(r.gl,{clearColor:a.clearColor?Z(a.clearColor):void 0,scale:a.scale,texFilter:a.texFilter}),E=Sr(),w=Rr(c,E,{errHandler:i=>{A.error(i)}}),A=Tr(c,w,{max:a.logMax}),m=(()=>a.connect?Pr(a.connect):null)();function v(i,n){if(!m)throw new Error("not connected to any websockets");m.recv(i,(d,p)=>{try{n(d,p)}catch(u){A.error(u)}})}s(v,"recv");function B(i,n){if(!m)throw new Error("not connected to any websockets");m.send(i,n)}s(B,"send");function k(){return r.dt()*Q.timeScale}s(k,"dt");function D(i,n={}){let d=w.sounds[i];if(!d)throw new Error(`sound not found: "${i}"`);return E.play(d,n)}s(D,"play");function f(i){var n;let d=R();return!((n=d.layers[i??d.defLayer])==null?void 0:n.noCam)}s(f,"isCamLayer");function b(i){return f(i)?R().cam.mpos:r.mousePos()}s(b,"mousePos");function M(i,n={}){var d;let p=(()=>typeof i=="string"?w.sprites[i]:i)();if(!p)throw new Error(`sprite not found: "${i}"`);let u=p.frames[(d=n.frame)!=null?d:0];c.drawTexture(p.tex,it(Oe({},n),{quad:u}))}s(M,"drawSprite");function F(i,n={}){var d;let p=(d=n.font)!=null?d:Ye,u=w.fonts[p];if(!u)throw new Error(`font not found: ${p}`);c.drawText(i,u,n)}s(F,"drawText");let X=980,q="topleft",_={loaded:!1,scenes:{},curScene:null,nextScene:null};function j(i,n){_.scenes[i]={init:n,initialized:!1,events:{add:[],update:[],draw:[],destroy:[],keyDown:[],keyPress:[],keyPressRep:[],keyRelease:[],mouseClick:[],mouseRelease:[],mouseDown:[],charInput:[]},action:[],render:[],objs:new Map,lastObjID:0,timers:{},lastTimerID:0,cam:{pos:g(c.width()/2,c.height()/2),scale:g(1,1),angle:0,shake:0,mpos:g(0),matrix:se()},layers:{},defLayer:null,gravity:X,data:{}}}s(j,"scene");function R(){return _.scenes[_.curScene]}s(R,"curScene");function l(){return R().data}s(l,"sceneData");function Y(){W("`",()=>{Q.showLog=!Q.showLog,A.info(`show log: ${Q.showLog?"on":"off"}`)}),W("f1",()=>{Q.inspect=!Q.inspect,A.info(`inspect: ${Q.inspect?"on":"off"}`)}),W("f2",()=>{Q.clearLog()}),W("f8",()=>{Q.paused=!Q.paused,A.info(`${Q.paused?"paused":"unpaused"}`)}),W("f7",()=>{Q.timeScale=ge(Q.timeScale-.2,0,2),A.info(`time scale: ${Q.timeScale.toFixed(1)}`)}),W("f9",()=>{Q.timeScale=ge(Q.timeScale+.2,0,2),A.info(`time scale: ${Q.timeScale.toFixed(1)}`)}),W("f10",()=>{Q.stepFrame(),A.info("stepped frame")})}s(Y,"regDebugInputs");function I(i,...n){_.nextScene={name:i,args:[...n]}}s(I,"go");function N(i,...n){re(i),_.curScene=i;let d=_.scenes[i];if(!d)throw new Error(`scene not found: '${i}'`);if(!d.initialized){try{d.init(...n)}catch(p){A.error(p.stack)}a.debug&&Y(),d.initialized=!0}}s(N,"goSync");function re(i){if(!_.scenes[i])throw new Error(`scene not found: '${i}'`);j(i,_.scenes[i].init)}s(re,"reload");function ie(i,n){let d=R();!d||(i.forEach((p,u)=>{d.layers[p]={alpha:1,order:u+1,noCam:!1}}),n&&(d.defLayer=n))}s(ie,"layers");function ae(...i){let n=R().cam;return i.length>0&&(n.pos=g(...i)),n.pos.clone()}s(ae,"camPos");function le(...i){let n=R().cam;return i.length>0&&(n.scale=g(...i)),n.scale.clone()}s(le,"camScale");function de(i){let n=R().cam;return i!==void 0&&(n.angle=i),n.angle}s(de,"camRot");function ve(i){let n=R().cam;n.shake=i}s(ve,"camShake");function fe(i){let n=R();i.forEach(d=>{n.layers[d]&&(n.layers[d].noCam=!0)})}s(fe,"camIgnore");function De(i){let n={hidden:!1,paused:!1,_tags:[],_id:null,_events:{add:[],update:[],draw:[],destroy:[],inspect:[]},use(u){if(u===void 0)return;let S=typeof u;if(S==="string"){this._tags.push(u);return}if(S!=="object")throw new Error(`invalid comp type: ${S}`);if(Array.isArray(u)){for(let h of u)this.use(h);return}for(let h in u){if(typeof u[h]=="function"){this._events[h]?this._events[h].push(u[h].bind(this)):this[h]=u[h].bind(this);continue}this[h]=u[h]}},exists(){return this._id!==void 0},is(u){if(u==="*")return!0;if(Array.isArray(u)){for(let S of u)if(!this._tags.includes(S))return!1;return!0}return this._tags.includes(u)},on(u,S){this._events[u]||(this._events[u]=[]),this._events[u].push(S)},action(u){this.on("update",u)},trigger(u,...S){if(this._events[u])for(let x of this._events[u])x.call(this,...S);let h=R().events[u];if(h)for(let x of h)this.is(x.tag)&&x.cb(this,...S)},rmTag(u){let S=this._tags.indexOf(u);S>-1&&this._tags.splice(S,1)}};n.use(i);let d=R(),p=d.lastObjID++;d.objs.set(p,n),n._id=p,n.trigger("add");for(let u of d.events.add)n.is(u.tag)&&u.cb(n);return n}s(De,"add");function y(i){if(!i.exists())return;let n=R();n.objs.delete(i._id);let d=n.lastObjID++;return n.objs.set(d,i),i._id=d,i}s(y,"readd");function T(i,n,d){let p=R();p.events[i]||(p.events[i]=[]),p.events[i].push({tag:n,cb:d})}s(T,"on");function P(i,n){typeof i=="function"&&n===void 0?R().action.push(i):typeof i=="string"&&T("update",i,n)}s(P,"action");function L(i,n){typeof i=="function"&&n===void 0?R().render.push(i):typeof i=="string"&&T("update",i,n)}s(L,"render");function G(i,n,d){P(i,p=>{p._checkCollisions(n,u=>{d(p,u)})})}s(G,"collides");function J(i,n,d){P(i,p=>{p._checkOverlaps(n,u=>{d(p,u)})})}s(J,"overlaps");function ee(i,n){P(i,d=>{d.isClicked()&&n(d)})}s(ee,"clicks");function C(i,n){return new Promise(d=>{let p=R();p.timers[p.lastTimerID++]={time:i,cb:()=>{n&&n(),d()}}})}s(C,"wait");function $(i,n){let d=!1,p=s(()=>{d||(n(),C(i,p))},"newF");return p(),{stop(){d=!0}}}s($,"loop");function z(i,n,d){if(Array.isArray(n))for(let p of n)z(i,p,d);else R().events[i].push({key:n,cb:d})}s(z,"pushKeyEvent");function U(i,n){z("keyDown",i,n)}s(U,"keyDown");function W(i,n){z("keyPress",i,n)}s(W,"keyPress");function pe(i,n){z("keyPressRep",i,n)}s(pe,"keyPressRep");function be(i,n){z("keyRelease",i,n)}s(be,"keyRelease");function Ue(i){R().events.charInput.push({cb:i})}s(Ue,"charInput");function Xe(i){R().events.mouseDown.push({cb:i})}s(Xe,"mouseDown");function xe(i){R().events.mouseClick.push({cb:i})}s(xe,"mouseClick");function tt(i){R().events.mouseRelease.push({cb:i})}s(tt,"mouseRelease");function Se(i){let n=R(),d=[...n.objs.values()].sort((p,u)=>{var S,h,x,O,H,K;let oe=(x=(h=n.layers[(S=p.layer)!=null?S:n.defLayer])==null?void 0:h.order)!=null?x:0,Ae=(K=(H=n.layers[(O=u.layer)!=null?O:n.defLayer])==null?void 0:H.order)!=null?K:0;return oe-Ae});return i?d.filter(p=>p.is(i)):d}s(Se,"get");function ne(i,n){typeof i=="function"&&n===void 0?Se().forEach(i):typeof i=="string"&&Se(i).forEach(n)}s(ne,"every");function Fe(i,n){typeof i=="function"&&n===void 0?Se().reverse().forEach(i):typeof i=="string"&&Se(i).reverse().forEach(n)}s(Fe,"revery");function _e(i){if(!i.exists())return;let n=R();!n||(i.trigger("destroy"),n.objs.delete(i._id),delete i._id)}s(_e,"destroy");function qe(i){ne(i,n=>{_e(n)})}s(qe,"destroyAll");function je(i){let n=R();return i!==void 0&&(n.gravity=i),n.gravity}s(je,"gravity");function Re(i){let n=R();if(!n)throw new Error(`scene not found: '${_.curScene}'`);let d=i||!Q.paused;if(d)for(let h in n.timers){let x=n.timers[h];x.time-=k(),x.time<=0&&(x.cb(),delete n.timers[h])}if(Fe(h=>{!h.paused&&d&&h.trigger("update")}),d)for(let h of n.action)h();let p=g(c.width(),c.height()),u=n.cam,S=rr(Ke(0,Math.PI*2)).scale(u.shake);u.shake=ze(u.shake,0,5*k()),u.matrix=se().translate(p.scale(.5)).scale(u.scale).rotateZ(u.angle).translate(p.scale(-.5)).translate(u.pos.scale(-1).add(p.scale(.5)).add(S)),u.mpos=u.matrix.invert().multVec2(r.mousePos()),ne(h=>{h.hidden||(c.pushTransform(),f(h.layer)&&c.pushMatrix(u.matrix),h.trigger("draw"),c.popTransform())});for(let h of n.render)h()}s(Re,"gameFrame");function rt(){let i=R();for(let n of i.events.charInput)r.charInputted().forEach(n.cb);for(let n of i.events.keyDown)r.keyDown(n.key)&&n.cb();for(let n of i.events.keyPress)r.keyPressed(n.key)&&n.cb();for(let n of i.events.keyPressRep)r.keyPressedRep(n.key)&&n.cb();for(let n of i.events.keyRelease)r.keyReleased(n.key)&&n.cb();for(let n of i.events.mouseDown)r.mouseDown()&&n.cb();for(let n of i.events.mouseClick)r.mouseClicked()&&n.cb();for(let n of i.events.mouseRelease)r.mouseReleased()&&n.cb()}s(rt,"handleEvents");function nt(){var i;let n=R(),d=null,p=w.defFont(),u=Z((i=a.inspectColor)!=null?i:[0,1,1,1]);function S(x,O,H){let K=g(4).scale(1/H),oe=c.fmtText(O,p,{size:12/H,pos:x.add(g(K.x,K.y))});c.drawRect(x,oe.width+K.x*2,oe.height+K.x*2,{color:Z(0,0,0,1)}),c.drawFmtText(oe)}s(S,"drawInspectTxt");function h(x,O){let H=f(x.layer),K=c.scale()*(H?(n.cam.scale.x+n.cam.scale.y)/2:1);H&&(c.pushTransform(),c.pushMatrix(n.cam.matrix)),O(K),H&&c.popTransform()}s(h,"drawObj"),Fe(x=>{!x.area||x.hidden||h(x,O=>{d||x.isHovered()&&(d=x);let H=(d===x?6:2)/O,K=x._worldArea(),oe=K.p2.x-K.p1.x,Ae=K.p2.y-K.p1.y;c.drawRectStroke(K.p1,oe,Ae,{width:H,color:u})})}),d&&h(d,x=>{let O=b(d.layer),H=[];for(let K of d._tags)H.push(`"${K}"`);for(let K of d._events.inspect){let oe=K();for(let Ae in oe)H.push(`${Ae}: ${oe[Ae]}`)}S(O,H.join(`
`),x)}),S(g(0),r.fps()+"",c.scale())}s(nt,"drawInspect");function kt(i,...n){r.run(()=>{if(c.frameStart(),_.loaded){try{if(!R())throw new Error(`scene not found: '${_.curScene}'`);rt(),Re(),Q.inspect&&nt()}catch(d){A.error(d.stack),r.quit()}Q.showLog&&A.draw(),_.nextScene&&(N.apply(null,[_.nextScene.name,..._.nextScene.args]),_.nextScene=null)}else{let d=w.loadProgress();if(d===1)_.loaded=!0,N(i,...n),m&&m.connect().catch(A.error);else{let p=c.width()/2,u=24/c.scale(),S=g(c.width()/2,c.height()/2).sub(g(p/2,u/2));c.drawRect(g(0),c.width(),c.height(),{color:st(0,0,0)}),c.drawRectStroke(S,p,u,{width:4/c.scale()}),c.drawRect(S,p*d,u)}}c.frameEnd()})}s(kt,"start");function pt(...i){return{pos:g(...i),move(...n){let d=g(...n),p=d.x*k(),u=d.y*k();this.pos.x+=p,this.pos.y+=u},inspect(){return{pos:`(${~~this.pos.x}, ${~~this.pos.y})`}}}}s(pt,"pos");function Yt(...i){return{scale:g(...i),flipX(n){this.scale.x=Math.sign(n)*Math.abs(this.scale.x)},flipY(n){this.scale.y=Math.sign(n)*Math.abs(this.scale.y)}}}s(Yt,"scale");function Ht(i){return{angle:i}}s(Ht,"rotate");function Nt(...i){return{color:Z(...i)}}s(Nt,"color");function Ut(i){return{origin:i}}s(Ut,"origin");function Xt(i){return{layer:i,inspect(){var n;let d=R();return{layer:(n=this.layer)!=null?n:d.defLayer}}}}s(Xt,"layer");function ot(i,n){var d,p;let u=R();return((d=i.layer)!=null?d:u.defLayer)===((p=n.layer)!=null?p:u.defLayer)}s(ot,"isSameLayer");function mt(i,n){let d={},p={};return{area:{p1:i,p2:n},areaWidth(){let{p1:u,p2:S}=this._worldArea();return S.x-u.x},areaHeight(){let{p1:u,p2:S}=this._worldArea();return S.y-u.y},isClicked(){return r.mouseClicked()&&this.isHovered()},isHovered(){return this.hasPt(b(this.layer))},isCollided(u){if(!u.area||!ot(this,u))return!1;let S=this._worldArea(),h=u._worldArea();return vt(S,h)},isOverlapped(u){if(!u.area||!ot(this,u))return!1;let S=this._worldArea(),h=u._worldArea();return dr(S,h)},clicks(u){this.action(()=>{this.isClicked()&&u()})},hovers(u){this.action(()=>{this.isHovered()&&u()})},collides(u,S){this.action(()=>{this._checkCollisions(u,S)})},overlaps(u,S){this.action(()=>{this._checkOverlaps(u,S)})},hasPt(u){let S=this._worldArea();return hr({p1:S.p1,p2:S.p2},u)},resolve(){let u=[];return ne(S=>{if(S===this||!S.solid||!S.area||!ot(this,S))return;let h=this._worldArea(),x=S._worldArea();if(!vt(h,x))return;let O=h.p2.x-x.p1.x,H=x.p2.x-h.p1.x,K=h.p2.y-x.p1.y,oe=x.p2.y-h.p1.y,Ae=Math.min(O,H,K,oe),jr=(()=>{switch(Ae){case O:return this.pos.x-=O,"right";case H:return this.pos.x+=H,"left";case K:return this.pos.y-=K,"bottom";case oe:return this.pos.y+=oe,"top"}})();u.push({obj:S,side:jr})}),u},_checkCollisions(u,S){ne(u,h=>{this!==h&&(d[h._id]||this.isCollided(h)&&(S(h),d[h._id]=h))});for(let h in d){let x=d[h];this.isCollided(x)||delete d[h]}},_checkOverlaps(u,S){ne(u,h=>{this!==h&&(p[h._id]||this.isOverlapped(h)&&(S(h),p[h._id]=h))});for(let h in p){let x=p[h];this.isOverlapped(x)||delete p[h]}},_worldArea(){let u=this.area,S=this.pos||g(0),h=this.scale||g(1),x=S.add(u.p1.dot(h)),O=S.add(u.p2.dot(h));return{p1:g(Math.min(x.x,O.x),Math.min(x.y,O.y)),p2:g(Math.max(x.x,O.x),Math.max(x.y,O.y))}}}}s(mt,"area");function Ge(i,n,d){let p=g(i,n),u=We(d||q).dot(p).scale(-.5);return mt(u.sub(p.scale(.5)),u.add(p.scale(.5)))}s(Ge,"getAreaFromSize");function qt(i,n={}){let d=w.sprites[i];if(!d)throw new Error(`sprite not found: "${i}"`);let p=Oe({},d.frames[0]);n.quad&&(p.x+=n.quad.x*p.w,p.y+=n.quad.y*p.h,p.w*=n.quad.w,p.h*=n.quad.h);let u=d.tex.width*p.w,S=d.tex.height*p.h,h=null;return{width:u,height:S,animSpeed:n.animSpeed||.1,frame:n.frame||0,quad:n.quad||ye(0,0,1,1),add(){!this.area&&!n.noArea&&this.use(Ge(this.width,this.height,this.origin))},draw(){let x=R(),O=d.frames[this.frame];M(d,{pos:this.pos,scale:this.scale,rot:this.angle,color:this.color,frame:this.frame,origin:this.origin,quad:this.quad,prog:w.shaders[this.shader],uniform:this.uniform})},update(){if(!h)return;let x=d.anims[h.name];h.timer+=k(),h.timer>=this.animSpeed&&(this.frame++,this.frame>x.to&&(h.loop?this.frame=x.from:(this.frame--,this.stop())),h&&(h.timer-=this.animSpeed))},play(x,O=!0){let H=d.anims[x];if(!H)throw new Error(`anim not found: ${x}`);h&&this.stop(),h={name:x,loop:O,timer:0},this.frame=H.from,this.trigger("animPlay",x)},stop(){if(!h)return;let x=h.name;h=null,this.trigger("animEnd",x)},changeSprite(x){if(d=w.sprites[x],!d)throw new Error(`sprite not found: "${x}"`);let O=Oe({},d.frames[0]);n.quad&&(O.x+=n.quad.x*O.w,O.y+=n.quad.y*O.h,O.w*=n.quad.w,O.h*=n.quad.h),this.width=d.tex.width*O.w,this.height=d.tex.height*O.h,this.area&&!n.noArea&&this.use(Ge(this.width,this.height,this.origin)),h=null,this.frame=0},numFrames(){return d.frames.length},curAnim(){return h==null?void 0:h.name},inspect(){let x={};return h&&(x.curAnim=`"${h.name}"`),x}}}s(qt,"sprite");function jt(i,n,d={}){return{text:i,textSize:n,font:d.font,width:0,height:0,add(){var p,u,S;if(!this.area&&!d.noArea){let h=R(),x=w.fonts[(p=this.font)!=null?p:Ye],O=c.fmtText(this.text+"",x,{pos:this.pos,scale:this.scale,rot:this.angle,size:this.textSize,origin:this.origin,color:this.color,width:d.width});this.width=O.width/(((u=this.scale)==null?void 0:u.x)||1),this.height=O.height/(((S=this.scale)==null?void 0:S.y)||1),this.use(Ge(this.width,this.height,this.origin))}},draw(){var p;let u=R(),S=w.fonts[(p=this.font)!=null?p:Ye],h=c.fmtText(this.text+"",S,{pos:this.pos,scale:this.scale,rot:this.angle,size:this.textSize,origin:this.origin,color:this.color,width:d.width});this.width=h.width,this.height=h.height,c.drawFmtText(h)}}}s(jt,"text");function Gt(i,n,d={}){return{width:i,height:n,add(){!this.area&&!d.noArea&&this.use(Ge(this.width,this.height,this.origin))},draw(){let p=R();c.drawRect(this.pos,this.width,this.height,{scale:this.scale,rot:this.angle,color:this.color,origin:this.origin,prog:w.shaders[this.shader],uniform:this.uniform})}}}s(Gt,"rect");function Vt(){return{solid:!0}}s(Vt,"solid");let Xr=960,qr=480;function zt(i={}){var n,d;let p=0,u=null,S=null,h=(n=i.maxVel)!=null?n:Xr;return{jumpForce:(d=i.jumpForce)!=null?d:qr,update(){this.move(0,p);let x=this.resolve(),O=!1;if(u&&(!u.exists()||!this.isCollided(u)?(u=null,S=null,O=!0):S&&(this.pos=this.pos.add(u.pos.sub(S)),S=u.pos.clone())),!u){p=Math.min(p+je()*k(),h);for(let H of x)H.side==="bottom"&&p>0?(u=H.obj,p=0,S=u.pos.clone(),O||this.trigger("grounded",u)):H.side==="top"&&p<0&&(p=0,this.trigger("headbump",H.obj))}},curPlatform(){return u},grounded(){return u!==null},falling(){return p>0},jump(x){u=null,p=-x||-this.jumpForce}}}s(zt,"body");function Jt(i,n={}){let d=w.shaders[i];return{shader:i,uniform:n}}s(Jt,"shader");let Q={paused:!1,inspect:!1,timeScale:1,showLog:!0,fps:r.fps,objCount(){return R().objs.size},stepFrame(){Re(!0)},drawCalls:c.drawCalls,clearLog:A.clear,log:A.info,error:A.error};function Kt(i,n){let d=[],p=g(n.pos||0),u=0,S={getPos(...h){let x=g(...h);return g(p.x+x.x*n.width,p.y+x.y*n.height)},spawn(h,x){let O=(()=>{if(Array.isArray(h))return h;if(n[h]){if(typeof n[h]=="function")return n[h]();if(Array.isArray(n[h]))return[...n[h]]}else if(n.any)return n.any(h)})();if(!O)return;O.push(pt(p.x+x.x*n.width,p.y+x.y*n.height));let H=De(O);return d.push(H),H.use({gridPos:x.clone(),setGridPos(K){this.gridPos=K.clone(),this.pos=g(p.x+this.gridPos.x*n.width,p.y+this.gridPos.y*n.height)},moveLeft(){this.setGridPos(this.gridPos.add(g(-1,0)))},moveRight(){this.setGridPos(this.gridPos.add(g(1,0)))},moveUp(){this.setGridPos(this.gridPos.add(g(0,-1)))},moveDown(){this.setGridPos(this.gridPos.add(g(0,1)))}}),H},width(){return u*n.width},height(){return i.length*n.height},destroy(){for(let h of d)_e(h)}};return i.forEach((h,x)=>{let O=h.split("");u=Math.max(O.length,u),O.forEach((H,K)=>{S.spawn(H,g(K,x))})}),S}s(Kt,"addLevel");let Ve={start:kt,loadRoot:w.loadRoot,loadSprite:w.loadSprite,loadSound:w.loadSound,loadFont:w.loadFont,loadShader:w.loadShader,addLoader:w.addLoader,width:c.width,height:c.height,dt:k,time:r.time,screenshot:r.screenshot,scene:j,go:I,sceneData:l,layers:ie,camPos:ae,camScale:le,camRot:de,camShake:ve,camIgnore:fe,gravity:je,add:De,readd:y,destroy:_e,destroyAll:qe,get:Se,every:ne,revery:Fe,send:B,recv:v,pos:pt,scale:Yt,rotate:Ht,color:Nt,origin:Ut,layer:Xt,area:mt,sprite:qt,text:jt,rect:Gt,solid:Vt,body:zt,shader:Jt,on:T,action:P,render:L,collides:G,overlaps:J,clicks:ee,keyDown:U,keyPress:W,keyPressRep:pe,keyRelease:be,charInput:Ue,mouseDown:Xe,mouseClick:xe,mouseRelease:tt,mousePos:b,cursor:r.cursor,keyIsDown:r.keyDown,keyIsPressed:r.keyPressed,keyIsPressedRep:r.keyPressedRep,keyIsReleased:r.keyReleased,mouseIsDown:r.mouseDown,mouseIsClicked:r.mouseClicked,mouseIsReleased:r.mouseReleased,loop:$,wait:C,play:D,volume:E.volume,makeRng:yt,rand:Ke,randSeed:lr,vec2:g,rgb:st,rgba:Z,quad:ye,choose:cr,chance:ur,lerp:ze,map:Je,mapc:tr,wave:ir,deg2rad:Zt,rad2deg:er,drawSprite:M,drawText:F,drawRect:c.drawRect,drawRectStroke:c.drawRectStroke,drawLine:c.drawLine,debug:Q,addLevel:Kt};if(a.plugins)for(let i of a.plugins){let n=i(Ve);for(let d in n)Ve[d]=n[d]}if(a.global)for(let i in Ve)window[i]=Ve[i];return Ve}}),Ir=on();function Pt(e){function t(m,v){m.on("destroy",()=>{e.destroy(v)})}function a(){let m=Date.now();return{age(){return Date.now()-m}}}function r(m){return{decay:1,...a(),update(){this.decay=1-this.age()/m,this.decay<=0&&e.destroy(this)}}}function c(){let m=e.pos();return{delta:e.vec2(0,0),add(){Object.assign(m,this.pos)},update(){this.delta.x=this.pos.x-m.x,this.delta.y=this.pos.y-m.y,Object.assign(m,this.pos)}}}function E(m,v){return{add(){this.use([e.pos(m.pos),e.origin(m.origin)]),t(m,this)},update(){let B=e.rotateVec(v,v,this.angle);this.pos=m.pos.add(B)}}}function w(m,v=0){return{add(){this.use([e.rotate(v),e.origin("center")])},update(){this.angle+=e.dt()*e.gravity()/m}}}function A(m){return{add(){this.use([e.pos(m.pos),e.rotate(m.angle),e.origin(m.origin)]),t(m,this)},update(){this.pos=m.pos,this.angle=m.angle}}}return{age:a,decay:r,delta:c,orbit:E,spin:w,sync:A}}function Mr(e,t){return Number.isInteger(e)?(e+t)%t:t*e}function Dr(e,t=1){return e.join(`
`.repeat(t+1))}function It(e){function t(c,E,w,A=1){return e.add([e.pos(Mr(E,e.width()),Mr(w,e.height())),e.color(A,A,A),...c])}function a(c,E,w,A,m){return e.add([e.text(Dr(c,A),m,{width:e.width()-2*E}),e.pos(E,w),{setText(v){this.text=Dr(v,A)}}])}function r(c,E){let w=e.addGUI([e.text(c+1,32),e.origin("center")],.5,.5);return e.loop(1,()=>{let A=w.text-1;A===0?E():w.text=A}),w}return{addGUI:t,addMessage:a,addCountdown:r}}function Mt(e){function t(){return e.vec2(e.width()/2,e.height()/2)}function a(r,c,E){return e.vec2(r*Math.cos(E)-c*Math.sin(E),r*Math.sin(E)+c*Math.cos(E))}return{center:t,rotateVec:a}}var He={MIN:1,MAX:3},he={SHIP:{X:100,Y:10},DEBRIS:{X:100,Y:100}},V={GAME:{X:800,Y:800},SHIP:{X:20,Y:40},BOOST:{X:10,Y:10},FLAME:{X:20,Y:5},SHIELD:{X:25,Y:45},SAT:{X:10,Y:10},STAR:{X:5,Y:5},DEBRIS:{MIN:{X:10,Y:10},MAX:{X:25,Y:25}}},Qe={BOOST:5,DEBRIS:3},Fr={GRAVITY:100},Te={BOOST:-1e3,DEBRIS:500,SAT:200,SPARK:-200},we={FLAME:1e3,FIRE:500,INFO:500,SAT:1e3,SHIELD:4e3,SPARK:2e3,TAIL:200},Dt={BOOST:10,DEBRIS:50},Ft={BOOST:6,DEBRIS:12},ct={SAT:3,INFO:6},_r={FLAME:40},Pe=1e3,Or=10,Br=20,Lr=480,_t=100;var Ie=!1,dt="0.1.29",Cr={};function kr(e,t,a){return Math.max(t,Math.min(a,e))}function Yr(e,t){return Math.max(t,Math.abs(e))*Math.sign(e)}function Ze(e){document.body.classList.toggle("mouse-control",e)}function Hr(){if(Ie||document.fullscreenElement)return;document.querySelector("canvas").requestFullscreen().catch(console.error)}function Nr(){let e=localStorage.getItem("highscore");return e?parseInt(e,10):0}function Ur(e){let t=Math.max(-1,...e);for(let a=0;a<t;a++)if(!e.includes(a))return a;return t+1}function Ot(e){function t(f){let b=Cr.extraBoost?!1:f%ct.SAT==ct.SAT-1;return e.add([e.rect(V.BOOST.X,V.BOOST.Y),e.pos(e.rand(0,e.width()-V.BOOST.X),e.rand(0,e.height()-V.BOOST.Y)),e.color(0,1,.5),e.spin(Te.BOOST/Math.sqrt(f+1)),"boost",{extra:b}])}function a(){let f=e.rand(0,e.width()),b=e.rand(0,Math.sign(e.width()/2-f)),M=e.rand(V.DEBRIS.MIN.X,V.DEBRIS.MAX.X),F=e.rand(V.DEBRIS.MIN.Y,V.DEBRIS.MAX.Y),X=Te.DEBRIS*Math.sign(M-F);return e.add([e.rect(M,F),e.pos(f,-e.height()),e.color(1,1,1),e.body(),e.spin(X),"debris",{direction:b}])}function r(f){return e.add([e.rect(f.width,f.width),e.pos(f.pos.x,f.pos.y),e.rotate(0),e.color(1,0,0),e.layer("background"),e.origin("center"),e.decay(we.FIRE),"fire"])}function c(f,b){let M=e.rotateVec(0,f.height/2,-f.angle),F=e.rotateVec(0,V.FLAME.Y,-f.angle).x;return e.add([e.rect(V.FLAME.X,V.FLAME.Y),e.pos(f.pos.add(M)),e.rotate(f.angle),e.color(...b?[0,1,1]:[1,1,0]),e.scale(1),e.layer("background"),e.origin("center"),e.decay(we.FLAME),"flame",{direction:F}])}function E(f,b=24,M=e.center()){let F=Math.max(1,f.length/ct.INFO);return e.add([e.text(f,b),e.color(1,1,0),e.scale(1),e.decay(we.INFO*F),e.pos(M),e.origin("center"),"fading"])}function w(f){let{r:b,g:M,b:F}=f.color;return e.add([e.rect(1,e.height()),e.color(b,M,F,.5),e.scale(0),e.sync(f),"pulse"])}function A(f){let b=e.get("satellite").map(({index:F})=>F),M=Ur(b);return e.add([e.rect(V.SAT.X,V.SAT.Y),e.color(0,1,1),e.spin(Te.SAT,Math.PI*2/(M+1)),e.orbit(f,V.SHIP.X*M+V.SHIP.Y*2),"satellite",{index:M}])}function m(f,b){return E(`${f}`,15+f/10,b)}function v(f){return e.add([e.rect(V.SHIELD.X,V.SHIELD.Y),e.color(0,1,1),e.scale(1),e.layer("background"),e.decay(we.SHIELD),e.sync(f),"shield","fading"])}function B(f){let{r:b,g:M,b:F}=f.color,X=f.pos;return e.add([e.rect(f.width/2,f.height/2),e.color(b,M,F),e.pos(X),e.spin(Te.SPARK),e.decay(we.SPARK),"spark",{center:X}])}function k(f=0){return e.add([e.rect(V.STAR.X,V.STAR.Y),e.pos(e.rand(0,e.width()-V.STAR.X),e.height()*1.5-e.camPos().y-f),e.color(1,1,1,e.rand(.1,.9)),e.layer("background"),e.age(),"star"])}function D(f){let{r:b,g:M,b:F}=f.color;return e.add([e.scale(1),e.color(b/2,M/2,F/2),e.pos(f.pos),e.rect(f.width,f.height),e.rotate(f.angle),e.origin("center"),e.layer("background"),e.decay(we.TAIL),"tail"])}return{spawnBoost:t,spawnDebris:a,spawnFire:r,spawnFlame:c,spawnInfo:E,spawnPulse:w,spawnSatellite:A,spawnScore:m,spawnShield:v,spawnSpark:B,spawnStar:k,spawnTail:D}}var ce=He.MIN,ht=Nr(),ft=null,et=!0;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),ft=e});function Ne(e,t){e.color.a=t?.5:1}function sn(){let e=null;!dt||o.render(()=>{e||!ft||(e=o.addGUI([o.text("install"),o.origin("bot"),"control"],.5,-te),e.clicks(()=>{ft.prompt(),ft=null}))})}function an(){let e=document.getElementById("instructions").textContent.replace(/\s+/g," ").trim(),t=o.add([o.text(e),o.pos(o.width(),300),"instructions"]);t.action(()=>{t.pos.x-=o.dt()*100,t.pos.x<-t.areaWidth()&&(t.pos.x=o.width())})}function ln(){let e=o.addGUI([o.text("sound",16),o.origin("topleft"),"control"],te,100),t=o.addGUI([o.text("shake",16),o.origin("topright"),"control"],-te,100);e.clicks(()=>{let a=o.volume((o.volume()+1)%2);Ne(e,a===0)}),t.clicks(()=>{et=!et,Ne(t,!et)}),Ne(e,o.volume()===0),Ne(t,!et)}function un(){let e=o.height();o.add([o.rect(te,e),o.pos(0,0),o.color(0,0,0)]),o.add([o.rect(te,e),o.pos(o.width(),0),o.color(0,0,0),o.origin("right")])}function Bt(e=0){let t=o.addMessage([],te,200,1,12);ht=Math.max(e,ht),localStorage.setItem("highscore",ht);function a(){t.setText([`Difficulty: ${ce}`,`Highscore: ${ht}`]),o.every("difficulty+",w=>{Ne(w,ce===He.MAX)}),o.every("difficulty-",w=>{Ne(w,ce===He.MIN)})}function r(w){ce=kr(w,He.MIN,He.MAX),a()}function c(){o.addGUI([o.text("+",32),o.origin("topright"),"control","difficulty+"],-te,te).clicks(()=>{r(ce+1)}),o.addGUI([o.text("-",32),o.origin("topleft"),"control","difficulty-"],te,te).clicks(()=>{r(ce-1)}),o.addGUI([o.text("START",32),o.origin("top"),"control"],.5,te).clicks(()=>{o.addCountdown(3,()=>{o.go("main",ce,!0,et)}),o.destroy(t),o.destroyAll("control"),o.destroyAll("instructions"),Hr()})}function E(){o.addMessage(["Press SPACE to start falling!","Use UP and DOWN to adjust the difficulty."],te,300,2),o.mouseClick(()=>{o.go("main",ce,!0,!1)})}dt&&o.addGUI([o.text(dt),o.origin("botright")],-te,-te).clicks(()=>{window.location.assign("about.html")}),Me?(c(),sn(),an(),ln()):E(),o.every("control",w=>{let A=o.vec2(0,w.areaHeight());w.area.p2=w.area.p2.add(A)}),o.keyPress("space",()=>{o.go("main",ce,!1,!1)}),o.keyPress("up",()=>{r(ce+1),a()}),o.keyPress("down",()=>{r(ce-1),a()}),a(),un()}function Lt(e,t,a){let r=o.play("soundtrack"),c=!1,E=!1,w=0;r.loop(),o.layers(["info","background","game"],"game"),o.addGUI([o.text("G"),o.origin("botright"),o.layer("info")],-10,-10,.5);let A=o.addGUI([o.text(),o.layer("info"),{value:0}],10,10),m=o.addGUI([o.rect(10,0),o.origin("botright"),o.layer("info"),{value:Pe}],-10,-25,.5),v=o.add([o.body({jumpForce:Lr}),o.pos(o.width()/2,o.height()/1.5),o.rect(V.SHIP.X,V.SHIP.Y),o.color(1,1,1),o.rotate(0),o.origin("center"),o.delta()]);function B(l,Y,I=v.pos){Y&&(l*=e,o.spawnScore(l,I)),A.value+=l,A.text=A.value}function k(l){m.value=Math.max(Pe,m.value+l),m.height=(m.value-Pe)/100,o.gravity(m.value)}function D(l){return(...Y)=>!c&&l(...Y)}function f(){let l=o.width();v.angle=(v.pos.x-l/2)/-l}function b(){let l=Math.min(0,v.pos.y-Br);o.camPos(o.camPos().x,o.height()/2+l)}function M(l){l.color=o.rgba(1,.5,0),l.direction=l.direction*-2,o.play("crash"),l.use(o.layer("background")),B(Dt.DEBRIS,!0,l.pos)}function F(){let l=o.mousePos(),Y=o.width();if(l.x<0&&v.pos.x<v.width||l.x>Y&&v.pos.x>Y-v.width)return;let I=Yr(o.mousePos().sub(v.pos).x,he.SHIP.X);v.move(I,he.SHIP.Y*Math.abs(I)/he.SHIP.X)}function X(){o.every("satellite",l=>{l.use([o.layer("background"),o.decay(we.SAT),"fading"])})}function q(){let l=o.get("flame").pop();(!l||l.age()>_r.FLAME)&&o.spawnFlame(v,E)}function _(){v.pos.y<0||(v.jump(),o.spawnFlame(v,E))}function j(l){o.camShake(l),a&&navigator.vibrate([l*10])}function R(){r.stop(),o.play("gameover"),o.go("death",A.value,c)}v.action(()=>{if(v.pos.y>=o.height())return R();if(c)return o.spawnFire(v);t&&F(),v.delta.y<-1&&q(),b(),f()}),v.collides("boost",l=>{let Y=e/2;w++,v.jump(m.value*Y),o.destroy(l),o.destroyAll("shield"),o.play("booster"),o.spawnSpark(l),j(Ft.BOOST),B(Dt.BOOST*w,!0),k((Pe-m.value)*Y),!c&&(o.spawnShield(v),l.extra&&o.spawnSatellite(v))}),v.collides("debris",l=>{if(j(Ft.DEBRIS),E)return M(l);c=!0,v.jump(Pe),v.use(o.spin(Te.DEBRIS)),o.spawnInfo("FUCK",32),o.play("crash",{volume:2}),o.destroy(l),X()}),o.collides("debris","satellite",(l,Y)=>{M(l),o.destroy(Y)}),o.action("star",l=>{l.pos.y-=l.age()/m.value*l.color.a,l.pos.y<-l.height&&(o.destroy(l),o.spawnStar())}),o.action("flame",l=>{let{r:Y,b:I}=l.color;l.color=o.rgba(Y,l.decay,I,l.decay),l.scale=o.vec2(.5+l.decay/2,1),l.pos.x+=l.direction}),o.action("fire",l=>{let Y=l.decay-o.rand(0,l.decay);l.color=o.rgba(Y,o.rand(0,Y/2),0,l.decay),l.angle+=o.dt()}),o.action("tail",l=>{let{r:Y,g:I,b:N}=l.color;l.color=o.rgba(Y,I,N,l.decay),l.scale=o.vec2(l.decay,l.decay)}),o.action("spark",l=>{l.color.a=l.decay,l.pos=l.center.add(o.rotateVec(V.BOOST.X,V.BOOST.Y,l.angle).scale(2-l.decay))}),o.action("pulse",l=>{l.scale=Math.cos(l.angle)}),o.action("debris",l=>{if(l.pos.y>o.height()+l.height)return o.destroy(l);l.move(l.direction*he.DEBRIS.X,-he.DEBRIS.Y/e-l.area.p1.dist(l.area.p2)),o.spawnTail(l)}),o.action("shield",l=>{r.detune(_t*l.decay)}),o.action("fading",l=>{l.color.a=l.decay,l.scale=1.2-l.decay/5}),o.action("satellite",l=>{l.is("fading")||o.spawnTail(l)}),o.on("add","boost",l=>{o.wait(Qe.BOOST,()=>{!l.exists()||(w=0,o.destroy(l),X())}),l.extra&&o.spawnPulse(l)}),o.on("destroy","boost",()=>{o.wait(Qe.BOOST,()=>{o.spawnBoost(w)})}),o.on("add","shield",()=>{E=!0,r.detune(_t)}),o.on("destroy","shield",()=>{E=!1,r.detune(0)}),o.gravity(Pe),o.camIgnore(["info"]),o.loop(1/e,()=>{B(1),k(Fr.GRAVITY)}),o.mouseClick(D(()=>{t||Ze(t=!0),_()})),o.keyPress("space",D(_)),o.keyDown("left",D(()=>{v.pos.x-v.width>0&&v.move(-he.SHIP.X,he.SHIP.Y)})),o.keyDown("right",D(()=>{v.pos.x+v.width<o.width()&&v.move(he.SHIP.X,he.SHIP.Y)})),o.wait(Qe.BOOST,()=>{o.spawnBoost(w)}),o.loop(Qe.DEBRIS,o.spawnDebris),Ze(t);for(let l=0;l<Or;l++)o.spawnStar(o.rand(0,o.height()));if(!!Ie)for(let l=0;l<10;l++)o.keyPress(`${l}`,()=>{w=l})}function Ct(e,t){o.addMessage([t?"Wrecked by space debris!":o.choose(["Gravity ate you up!","Newton fucked you!","There's no light at the end of the wormhole!","You could not resist the force of gravity!"]),`Your score was ${e}.`],te,200,2),o.wait(3,()=>o.go("start",e)),Ze(!1)}var Me=window.innerWidth<V.GAME.X||window.innerHeight<V.GAME.Y,o=window.k=Ir({fullscreen:Me,width:Me?null:V.GAME.X,height:Me?null:V.GAME.Y,clearColor:[0,0,0],plugins:[Pt,It,Mt,Ot],debug:Ie}),te=Me?20:100;o.loadSound("soundtrack","media/soundtrack.mp3");o.loadSound("gameover","media/gameover.mp3");o.loadSound("booster","media/booster.mp3");o.loadSound("crash","media/crash.mp3");o.scene("start",Bt);o.scene("main",Lt);o.scene("death",Ct);o.start("start");document.body.classList.toggle("is-fullscreen",Me);"serviceWorker"in navigator&&!Ie&&navigator.serviceWorker.register("sw.js").catch(console.error);})();
//# sourceMappingURL=game.js.map
