(()=>{var Qt=Object.defineProperty,Vr=Object.defineProperties,Jr=Object.getOwnPropertyDescriptors,Zt=Object.getOwnPropertySymbols,Kr=Object.prototype.hasOwnProperty,Wr=Object.prototype.propertyIsEnumerable,er=(e,t,a)=>t in e?Qt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Be=(e,t)=>{for(var a in t||(t={}))Kr.call(t,a)&&er(e,a,t[a]);if(Zt)for(var a of Zt(t))Wr.call(t,a)&&er(e,a,t[a]);return e},st=(e,t)=>Vr(e,Jr(t)),s=(e,t)=>Qt(e,"name",{value:t,configurable:!0}),me=(e,t)=>()=>(e&&(t=e(e=0)),t),$r=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);function tr(e){return e*Math.PI/180}function rr(e){return e*180/Math.PI}function ge(e,t,a){return t>a?ge(e,a,t):Math.min(Math.max(e,t),a)}function Ve(e,t,a){return e+(t-e)*a}function Je(e,t,a,r,l){return r+(e-t)/(a-t)*(l-r)}function nr(e,t,a,r,l){return ge(Je(e,t,a,r,l),r,l)}function m(...e){if(e.length===0)return m(0,0);if(e.length===1){if(typeof e[0]=="number")return m(e[0],e[0]);if(Oe(e[0]))return m(e[0].x,e[0].y);if(Array.isArray(e[0])&&e[0].length===2)return m.apply(null,e[0])}return{x:e[0],y:e[1],clone(){return m(this.x,this.y)},add(...t){let a=m(...t);return m(this.x+a.x,this.y+a.y)},sub(...t){let a=m(...t);return m(this.x-a.x,this.y-a.y)},scale(t){return m(this.x*t,this.y*t)},dist(...t){let a=m(...t);return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))},len(){return this.dist(m(0,0))},unit(){return this.scale(1/this.len())},normal(){return m(this.y,-this.x)},dot(...t){let a=m(...t);return m(this.x*a.x,this.y*a.y)},angle(...t){let a=m(...t);return Math.atan2(this.y-a.y,this.x-a.x)},lerp(t,a){return m(Ve(this.x,t.x,a),Ve(this.y,t.y,a))},eq(t){return this.x===t.x&&this.y===t.y},str(){return`(${this.x}, ${this.y})`}}}function or(e){return m(Math.cos(e),Math.sin(e))}function Le(e,t,a){return{x:e,y:t,z:a,xy(){return m(this.x,this.y)}}}function Oe(e){return e!==void 0&&e.x!==void 0&&e.y!==void 0}function ir(e){return e!==void 0&&e.x!==void 0&&e.y!==void 0&&e.z!==void 0}function Te(e){return e!==void 0&&e.r!==void 0&&e.g!==void 0&&e.b!==void 0&&e.a!==void 0}function sr(e){if(e!==void 0&&Array.isArray(e.m)&&e.m.length===16)return e}function at(...e){if(e.length===0)return Z();if(e.length===1){if(Te(e[0]))return Z(e[0]);if(Array.isArray(e[0])&&e[0].length===3)return at.apply(null,e[0])}return Z(e[0],e[1],e[2],1)}function Z(...e){var t;if(e.length===0)return Z(1,1,1,1);if(e.length===1){if(Te(e[0]))return Z(e[0].r,e[0].g,e[0].b,e[0].a);if(Array.isArray(e[0])&&e[0].length===4)return Z.apply(null,e[0])}return{r:e[0],g:e[1],b:e[2],a:(t=e[3])!=null?t:1,clone(){return Z(this.r,this.g,this.b,this.a)},lighten(a){return Z(this.r+a,this.g+a,this.b+a,this.a)},darken(a){return this.lighten(-a)},invert(){return Z(1-this.r,1-this.g,1-this.b,this.a)},isDark(a=.5){return this.r+this.g+this.b<3*a},isLight(a=.5){return this.r+this.g+this.b>3*a},eq(a){return this.r===a.r&&this.g===a.g&&this.b===a.g&&this.a===a.a}}}function ye(e,t,a,r){return{x:e,y:t,w:a,h:r,clone(){return ye(this.x,this.y,this.w,this.h)},eq(l){return this.x===l.x&&this.y===l.y&&this.w===l.w&&this.h===l.h}}}function ae(e){return{m:e?[...e]:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],clone(){return ae(this.m)},mult(t){let a=[];for(let r=0;r<4;r++)for(let l=0;l<4;l++)a[r*4+l]=this.m[0*4+l]*t.m[r*4+0]+this.m[1*4+l]*t.m[r*4+1]+this.m[2*4+l]*t.m[r*4+2]+this.m[3*4+l]*t.m[r*4+3];return ae(a)},multVec4(t){return{x:t.x*this.m[0]+t.y*this.m[4]+t.z*this.m[8]+t.w*this.m[12],y:t.x*this.m[1]+t.y*this.m[5]+t.z*this.m[9]+t.w*this.m[13],z:t.x*this.m[2]+t.y*this.m[6]+t.z*this.m[10]+t.w*this.m[14],w:t.x*this.m[3]+t.y*this.m[7]+t.z*this.m[11]+t.w*this.m[15]}},multVec3(t){let a=this.multVec4({x:t.x,y:t.y,z:t.z,w:1});return Le(a.x,a.y,a.z)},multVec2(t){return m(t.x*this.m[0]+t.y*this.m[4]+0*this.m[8]+1*this.m[12],t.x*this.m[1]+t.y*this.m[5]+0*this.m[9]+1*this.m[13])},translate(t){return this.mult(ae([1,0,0,0,0,1,0,0,0,0,1,0,t.x,t.y,0,1]))},scale(t){return this.mult(ae([t.x,0,0,0,0,t.y,0,0,0,0,1,0,0,0,0,1]))},rotateX(t){return this.mult(ae([1,0,0,0,0,Math.cos(t),-Math.sin(t),0,0,Math.sin(t),Math.cos(t),0,0,0,0,1]))},rotateY(t){return this.mult(ae([Math.cos(t),0,-Math.sin(t),0,0,1,0,0,Math.sin(t),0,Math.cos(t),0,0,0,0,1]))},rotateZ(t){return this.mult(ae([Math.cos(t),-Math.sin(t),0,0,Math.sin(t),Math.cos(t),0,0,0,0,1,0,0,0,0,1]))},invert(){let t=[],a=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],l=this.m[9]*this.m[14]-this.m[13]*this.m[10],S=this.m[8]*this.m[15]-this.m[12]*this.m[11],y=this.m[8]*this.m[14]-this.m[12]*this.m[10],A=this.m[8]*this.m[13]-this.m[12]*this.m[9],w=this.m[6]*this.m[15]-this.m[14]*this.m[7],I=this.m[5]*this.m[15]-this.m[13]*this.m[7],v=this.m[5]*this.m[14]-this.m[13]*this.m[6],O=this.m[4]*this.m[15]-this.m[12]*this.m[7],_=this.m[4]*this.m[14]-this.m[12]*this.m[6],f=this.m[5]*this.m[15]-this.m[13]*this.m[7],E=this.m[4]*this.m[13]-this.m[12]*this.m[5],D=this.m[6]*this.m[11]-this.m[10]*this.m[7],F=this.m[5]*this.m[11]-this.m[9]*this.m[7],z=this.m[5]*this.m[10]-this.m[9]*this.m[6],k=this.m[4]*this.m[11]-this.m[8]*this.m[7],B=this.m[4]*this.m[10]-this.m[8]*this.m[6],q=this.m[4]*this.m[9]-this.m[8]*this.m[5];t[0]=this.m[5]*a-this.m[6]*r+this.m[7]*l,t[4]=-(this.m[4]*a-this.m[6]*S+this.m[7]*y),t[8]=this.m[4]*r-this.m[5]*S+this.m[7]*A,t[12]=-(this.m[4]*l-this.m[5]*y+this.m[6]*A),t[1]=-(this.m[1]*a-this.m[2]*r+this.m[3]*l),t[5]=this.m[0]*a-this.m[2]*S+this.m[3]*y,t[9]=-(this.m[0]*r-this.m[1]*S+this.m[3]*A),t[13]=this.m[0]*l-this.m[1]*y+this.m[2]*A,t[2]=this.m[1]*w-this.m[2]*I+this.m[3]*v,t[6]=-(this.m[0]*w-this.m[2]*O+this.m[3]*_),t[10]=this.m[0]*f-this.m[1]*O+this.m[3]*E,t[14]=-(this.m[0]*v-this.m[1]*_+this.m[2]*E),t[3]=-(this.m[1]*D-this.m[2]*F+this.m[3]*z),t[7]=this.m[0]*D-this.m[2]*k+this.m[3]*B,t[11]=-(this.m[0]*F-this.m[1]*k+this.m[3]*q),t[15]=this.m[0]*z-this.m[1]*B+this.m[2]*q;let R=this.m[0]*t[0]+this.m[1]*t[4]+this.m[2]*t[8]+this.m[3]*t[12];for(let u=0;u<4;u++)for(let H=0;H<4;H++)t[u*4+H]*=1/R;return ae(t)}}}function ar(e,t,a){return e+(Math.sin(a)+1)/2*(t-e)}function wt(e){return{seed:e,gen(...t){if(t.length===0)return this.seed=(ur*this.seed+lr)%yt,this.seed/yt;if(t.length===1){if(typeof t[0]=="number")return this.gen(0,t[0]);if(Oe(t[0]))return this.gen(m(0,0),t[0]);if(Te(t[0]))return this.gen(Z(0,0,0,0),t[0])}else if(t.length===2){if(typeof t[0]=="number"&&typeof t[1]=="number")return this.gen()*(t[1]-t[0])+t[0];if(Oe(t[0])&&Oe(t[1]))return m(this.gen(t[0].x,t[1].x),this.gen(t[0].y,t[1].y));if(Te(t[0])&&Te(t[1]))return Z(this.gen(t[0].r,t[1].r),this.gen(t[0].g,t[1].g),this.gen(t[0].b,t[1].b),this.gen(t[0].a,t[1].a))}}}}function cr(e){vt.seed=e}function Ke(...e){return vt.gen(...e)}function dr(e){return Ke()<=e}function hr(e){return e[Math.floor(Ke(e.length))]}function xt(e,t){return e.p2.x>=t.p1.x&&e.p1.x<=t.p2.x&&e.p2.y>=t.p1.y&&e.p1.y<=t.p2.y}function fr(e,t){return e.p2.x>t.p1.x&&e.p1.x<t.p2.x&&e.p2.y>t.p1.y&&e.p1.y<t.p2.y}function pr(e,t){return t.x>=e.p1.x&&t.x<=e.p2.x&&t.y>=e.p1.y&&t.y<e.p2.y}var ur,lr,yt,vt,Ce=me(()=>{s(tr,"deg2rad"),s(rr,"rad2deg"),s(ge,"clamp"),s(Ve,"lerp"),s(Je,"map"),s(nr,"mapc"),s(m,"vec2"),s(or,"vec2FromAngle"),s(Le,"vec3"),s(Oe,"isVec2"),s(ir,"isVec3"),s(Te,"isColor"),s(sr,"isMat4"),s(at,"rgb"),s(Z,"rgba"),s(ye,"quad"),s(ae,"mat4"),s(ar,"wave"),ur=1103515245,lr=12345,yt=2147483648,vt=wt(Date.now()),s(wt,"makeRng"),s(cr,"randSeed"),s(Ke,"rand"),s(dr,"chance"),s(hr,"choose"),s(xt,"colRectRect"),s(fr,"overlapRectRect"),s(pr,"colRectPt")});function St(e,t){let a=typeof e,r=typeof t;if(a!==r)return!1;if(a==="object"&&r==="object"){let l=Object.keys(e),S=Object.keys(t);if(l.length!==S.length)return!1;for(let y of l){let A=e[y],w=t[y];if(!(typeof A=="function"&&typeof w=="function")&&!St(A,w))return!1}return!0}return e===t}var Qr=me(()=>{s(St,"deepEq")});function We(e){switch(e){case"topleft":return m(-1,-1);case"top":return m(0,-1);case"topright":return m(1,-1);case"left":return m(-1,0);case"center":return m(0,0);case"right":return m(1,0);case"botleft":return m(-1,1);case"bot":return m(0,1);case"botright":return m(1,1);default:return e}}function yr(e,t){let a=(()=>{switch(t.texFilter){case"linear":return e.LINEAR;case"nearest":return e.NEAREST;default:return e.NEAREST}})(),r=(()=>{var g;let P=y(lt,ct),T=S(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),C=(g=t.clearColor)!=null?g:Z(0,0,0,1);e.clearColor(C.r,C.g,C.b,C.a),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);let j=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,j),e.bufferData(e.ARRAY_BUFFER,$e*4,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null);let J=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,J),e.bufferData(e.ELEMENT_ARRAY_BUFFER,$e*2,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);let ee=S(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2));return{drawCalls:0,lastDrawCalls:0,defProg:P,curProg:P,defTex:T,curTex:T,curUniform:{},vbuf:j,ibuf:J,vqueue:[],iqueue:[],transform:ae(),transformStack:[],clearColor:C,bgTex:ee}})();v(),O();function l(g){return Math.log(g)/Math.log(2)%1==0}s(l,"powerOfTwo");function S(g){let P=e.createTexture();e.bindTexture(e.TEXTURE_2D,P),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,g),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a);let T=(()=>l(g.width)&&l(g.height)?e.REPEAT:e.CLAMP_TO_EDGE)();return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,T),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,T),e.bindTexture(e.TEXTURE_2D,null),{width:g.width,height:g.height,bind(){e.bindTexture(e.TEXTURE_2D,P)},unbind(){e.bindTexture(e.TEXTURE_2D,null)}}}s(S,"makeTex");function y(g=lt,P=ct){let T,C=mr.replace("{{user}}",g??lt),j=gr.replace("{{user}}",P??ct),J=e.createShader(e.VERTEX_SHADER),ee=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(J,C),e.shaderSource(ee,j),e.compileShader(J),e.compileShader(ee),T=e.getShaderInfoLog(J))throw new Error(T);if(T=e.getShaderInfoLog(ee))throw new Error(T);let Y=e.createProgram();if(e.attachShader(Y,J),e.attachShader(Y,ee),e.bindAttribLocation(Y,0,"a_pos"),e.bindAttribLocation(Y,1,"a_uv"),e.bindAttribLocation(Y,2,"a_color"),e.linkProgram(Y),(T=e.getProgramInfoLog(Y))&&T!==`
`)throw new Error(T);return{bind(){e.useProgram(Y)},unbind(){e.useProgram(null)},bindAttribs(){e.vertexAttribPointer(0,3,e.FLOAT,!1,Ye*4,0),e.enableVertexAttribArray(0),e.vertexAttribPointer(1,2,e.FLOAT,!1,Ye*4,12),e.enableVertexAttribArray(1),e.vertexAttribPointer(2,4,e.FLOAT,!1,Ye*4,20),e.enableVertexAttribArray(2)},send($){this.bind();for(let V in $){let X=$[V],W=e.getUniformLocation(Y,V);typeof X=="number"?e.uniform1f(W,X):sr(X)?e.uniformMatrix4fv(W,!1,new Float32Array(X.m)):Te(X)?e.uniform4f(W,X.r,X.g,X.b,X.a):ir(X)?e.uniform3f(W,X.x,X.y,X.z):Oe(X)&&e.uniform2f(W,X.x,X.y)}this.unbind()}}}s(y,"makeProgram");function A(g,P,T,C){let j=g.width/P,J=g.height/T,ee=1/j,Y=1/J,$={},V=C.split("").entries();for(let[X,W]of V)$[W]=m(X%j*ee,Math.floor(X/j)*Y);return{tex:g,map:$,qw:ee,qh:Y}}s(A,"makeFont");function w(g,P,T=r.defTex,C=r.defProg,j={}){T=T??r.defTex,C=C??r.defProg,(T!==r.curTex||C!==r.curProg||!St(r.curUniform,j)||r.vqueue.length+g.length*Ye>$e||r.iqueue.length+P.length>$e)&&I(),r.curTex=T,r.curProg=C,r.curUniform=j;let J=P.map(Y=>Y+r.vqueue.length/Ye),ee=g.map(Y=>{let $=f(r.transform.multVec2(Y.pos.xy()));return[$.x,$.y,Y.pos.z,Y.uv.x,Y.uv.y,Y.color.r,Y.color.g,Y.color.b,Y.color.a]}).flat();J.forEach(Y=>r.iqueue.push(Y)),ee.forEach(Y=>r.vqueue.push(Y))}s(w,"drawRaw");function I(){!r.curTex||!r.curProg||r.vqueue.length===0||r.iqueue.length===0||(r.curProg.send(r.curUniform),e.bindBuffer(e.ARRAY_BUFFER,r.vbuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(r.vqueue)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.ibuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(r.iqueue)),r.curProg.bind(),r.curProg.bindAttribs(),r.curTex.bind(),e.drawElements(e.TRIANGLES,r.iqueue.length,e.UNSIGNED_SHORT,0),r.curTex.unbind(),r.curProg.unbind(),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),r.iqueue=[],r.vqueue=[],r.drawCalls++)}s(I,"flush");function v(){e.clear(e.COLOR_BUFFER_BIT),t.clearColor||u({width:de(),height:ve(),quad:ye(0,0,de()*fe()/At,ve()*fe()/At),tex:r.bgTex}),r.drawCalls=0,r.transformStack=[],r.transform=ae()}s(v,"frameStart");function O(){I(),r.lastDrawCalls=r.drawCalls}s(O,"frameEnd");function _(){return r.lastDrawCalls}s(_,"drawCalls");function f(g){return m(g.x/de()*2-1,-g.y/ve()*2+1)}s(f,"toNDC");function E(g){r.transform=g.clone()}s(E,"pushMatrix");function D(g){!g||g.x===0&&g.y===0||(r.transform=r.transform.translate(g))}s(D,"pushTranslate");function F(g){!g||g.x===1&&g.y===1||(r.transform=r.transform.scale(g))}s(F,"pushScale");function z(g){!g||(r.transform=r.transform.rotateX(g))}s(z,"pushRotateX");function k(g){!g||(r.transform=r.transform.rotateY(g))}s(k,"pushRotateY");function B(g){!g||(r.transform=r.transform.rotateZ(g))}s(B,"pushRotateZ");function q(){r.transformStack.push(r.transform.clone())}s(q,"pushTransform");function R(){r.transformStack.length>0&&(r.transform=r.transformStack.pop())}s(R,"popTransform");function u(g={}){var P,T;let C=g.width||0,j=g.height||0,J=g.pos||m(0,0),ee=We(g.origin||ut).dot(m(C,j).scale(-.5)),Y=m((P=g.scale)!=null?P:1),$=g.rot||0,V=g.quad||ye(0,0,1,1),X=1-((T=g.z)!=null?T:0),W=g.color||Z(1,1,1,1);q(),D(J),F(Y),B($),D(ee),w([{pos:Le(-C/2,j/2,X),uv:m(V.x,V.y+V.h),color:W},{pos:Le(-C/2,-j/2,X),uv:m(V.x,V.y),color:W},{pos:Le(C/2,-j/2,X),uv:m(V.x+V.w,V.y),color:W},{pos:Le(C/2,j/2,X),uv:m(V.x+V.w,V.y+V.h),color:W}],[0,1,3,1,2,3],g.tex,g.prog,g.uniform),R()}s(u,"drawQuad");function H(g,P={}){var T;let C=(T=P.quad)!=null?T:ye(0,0,1,1),j=g.width*C.w,J=g.height*C.h;u(st(Be({},P),{tex:g,quad:C,width:j,height:J}))}s(H,"drawTexture");function M(g,P,T,C={}){u(st(Be({},C),{pos:g,width:P,height:T}))}s(M,"drawRect");function U(g,P,T,C={}){let j=We(C.origin||ut).dot(m(P,T)).scale(.5),J=g.add(m(-P/2,-T/2)).sub(j),ee=g.add(m(-P/2,T/2)).sub(j),Y=g.add(m(P/2,T/2)).sub(j),$=g.add(m(P/2,-T/2)).sub(j);re(J,ee,C),re(ee,Y,C),re(Y,$,C),re($,J,C)}s(U,"drawRectStroke");function re(g,P,T={}){let C=T.width||1,j=g.dist(P),J=Math.PI/2-g.angle(P);u(st(Be({},T),{pos:g.add(P).scale(.5),width:C,height:j,rot:J,origin:"center"}))}s(re,"drawLine");function ie(g,P,T={}){let C=(g+"").split(""),j=P.qw*P.tex.width,J=P.qh*P.tex.height,ee=T.size||J,Y=m(ee/J).dot(m(T.scale||1)),$=Y.x*j,V=Y.y*J,X=0,W=V,pe=0,Ee=[[]];for(let ne of C)(ne===`
`||(T.width?X+$>T.width:!1))&&(W+=V,X=0,Ee.push([])),ne!==`
`&&(Ee[Ee.length-1].push(ne),X+=$),pe=Math.max(pe,X);T.width&&(pe=T.width);let Ue=[],Xe=m(T.pos||0),xe=We(T.origin||ut).scale(.5),rt=-xe.x*$-(xe.x+.5)*(pe-$),Se=-xe.y*V-(xe.y+.5)*(W-V);return Ee.forEach((ne,Fe)=>{let _e=(pe-ne.length*$)*(xe.x+.5);ne.forEach((qe,je)=>{let Pe=P.map[qe],nt=je*$,ot=Fe*V;Pe&&Ue.push({tex:P.tex,quad:ye(Pe.x,Pe.y,P.qw,P.qh),ch:qe,pos:m(Xe.x+nt+rt+_e,Xe.y+ot+Se),color:T.color,origin:T.origin,scale:Y,z:T.z})})}),{width:pe,height:W,chars:Ue}}s(ie,"fmtText");function ue(g,P,T={}){le(ie(g,P,T))}s(ue,"drawText");function le(g){for(let P of g.chars)u({tex:P.tex,width:P.tex.width*P.quad.w,height:P.tex.height*P.quad.h,pos:P.pos,scale:P.scale,color:P.color,quad:P.quad,origin:"center",z:P.z})}s(le,"drawFmtText");function de(){return e.drawingBufferWidth/fe()}s(de,"width");function ve(){return e.drawingBufferHeight/fe()}s(ve,"height");function fe(){var g;return(g=t.scale)!=null?g:1}s(fe,"scale");function De(){return r.clearColor.clone()}return s(De,"clearColor"),{width:de,height:ve,scale:fe,makeTex:S,makeProgram:y,makeFont:A,drawTexture:H,drawText:ue,drawFmtText:le,drawRect:M,drawRectStroke:U,drawLine:re,fmtText:ie,frameStart:v,frameEnd:O,pushTransform:q,popTransform:R,pushMatrix:E,drawCalls:_,clearColor:De}}var ut,Ye,$e,At,mr,gr,lt,ct,Zr=me(()=>{Ce(),Qr(),ut="topleft",Ye=9,$e=65536,At=64,mr=`
attribute vec3 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec3 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,gr=`
precision mediump float;

varying vec3 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,lt=`
vec4 vert(vec3 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,ct=`
vec4 frag(vec3 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,s(We,"originPt"),s(yr,"gfxInit")});function bt(e){return e==="pressed"||e==="rpressed"?"down":e==="released"?"up":e}function wr(e={}){var t,a;let r={canvas:(t=e.canvas)!=null?t:(()=>{var M;let U=document.createElement("canvas");return((M=e.root)!=null?M:document.body).appendChild(U),U})(),keyStates:{},charInputted:[],mouseState:"up",mousePos:m(0,0),time:0,realTime:0,skipTime:!1,dt:0,scale:(a=e.scale)!=null?a:1,isTouch:!1,loopID:null,stopped:!1,fps:0,fpsBuf:[],fpsTimer:0},l={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"},S=["space","left","right","up","down","tab","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11"];e.fullscreen?(r.canvas.width=window.innerWidth,r.canvas.height=window.innerHeight):(r.canvas.width=(e.width||640)*r.scale,r.canvas.height=(e.height||480)*r.scale);let y=["outline: none","cursor: default"];e.crisp&&(y.push("image-rendering: pixelated"),y.push("image-rendering: crisp-edges")),r.canvas.style=y.join(";"),r.canvas.setAttribute("tabindex","0");let A=r.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});r.isTouch="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,r.canvas.addEventListener("mousemove",M=>{r.mousePos=m(M.offsetX,M.offsetY).scale(1/r.scale)}),r.canvas.addEventListener("mousedown",()=>{r.mouseState="pressed"}),r.canvas.addEventListener("mouseup",()=>{r.mouseState="released"}),r.canvas.addEventListener("touchstart",M=>{let U=M.touches[0];r.mousePos=m(U.clientX,U.clientY).scale(1/r.scale),r.mouseState="pressed"}),r.canvas.addEventListener("touchmove",M=>{let U=M.touches[0];r.mousePos=m(U.clientX,U.clientY).scale(1/r.scale)}),r.canvas.addEventListener("keydown",M=>{let U=l[M.key]||M.key.toLowerCase();S.includes(U)&&M.preventDefault(),U.length===1&&r.charInputted.push(U),U==="space"&&r.charInputted.push(" "),M.repeat?r.keyStates[U]="rpressed":r.keyStates[U]="pressed"}),r.canvas.addEventListener("keyup",M=>{let U=l[M.key]||M.key.toLowerCase();r.keyStates[U]="released"}),r.canvas.focus(),document.addEventListener("visibilitychange",()=>{switch(document.visibilityState){case"visible":r.skipTime=!0;break;case"hidden":break}});function w(){return r.mousePos.clone()}s(w,"mousePos");function I(){return r.mouseState==="pressed"}s(I,"mouseClicked");function v(){return r.mouseState==="pressed"||r.mouseState==="down"}s(v,"mouseDown");function O(){return r.mouseState==="released"}s(O,"mouseReleased");function _(M){return r.keyStates[M]==="pressed"}s(_,"keyPressed");function f(M){return r.keyStates[M]==="pressed"||r.keyStates[M]==="rpressed"}s(f,"keyPressedRep");function E(M){return r.keyStates[M]==="pressed"||r.keyStates[M]==="rpressed"||r.keyStates[M]==="down"}s(E,"keyDown");function D(M){return r.keyStates[M]==="released"}s(D,"keyReleased");function F(){return[...r.charInputted]}s(F,"charInputted");function z(){return r.dt}s(z,"dt");function k(){return r.time}s(k,"time");function B(){return r.fps}s(B,"fps");function q(){return r.canvas.toDataURL()}s(q,"screenshot");function R(M){return M&&(r.canvas.style.cursor=M??"default"),r.canvas.style.cursor}s(R,"cursor");function u(M){let U=s(re=>{let ie=re/1e3,ue=ie-r.realTime;r.realTime=ie,r.skipTime||(r.dt=ue,r.time+=r.dt,r.fpsBuf.push(1/r.dt),r.fpsTimer+=r.dt,r.fpsTimer>=1&&(r.fpsTimer=0,r.fps=Math.round(r.fpsBuf.reduce((le,de)=>le+de)/r.fpsBuf.length),r.fpsBuf=[])),r.skipTime=!1,M();for(let le in r.keyStates)r.keyStates[le]=bt(r.keyStates[le]);r.mouseState=bt(r.mouseState),r.charInputted=[],r.stopped||(r.loopID=requestAnimationFrame(U))},"frame");r.loopID=requestAnimationFrame(U)}s(u,"run");function H(){cancelAnimationFrame(r.loopID),r.stopped=!0}return s(H,"quit"),{gl:A,mousePos:w,keyDown:E,keyPressed:_,keyPressedRep:f,keyReleased:D,mouseDown:v,mouseClicked:I,mouseReleased:O,charInputted:F,cursor:R,dt:z,time:k,fps:B,screenshot:q,run:u,quit:H}}var en=me(()=>{Ce(),s(bt,"processBtnState"),s(wr,"appInit")});function br(){let e=(()=>{let l=new(window.AudioContext||window.webkitAudioContext),S=l.createGain(),y=S;return y.connect(l.destination),{ctx:l,gainNode:S,masterNode:y}})();function t(l){return l!==void 0&&(e.gainNode.gain.value=ge(l,Rt,Et)),e.gainNode.gain.value}s(t,"volume");function a(l,S={loop:!1,volume:1,speed:1,detune:0,seek:0}){var y;let A=!1,w=e.ctx.createBufferSource();w.buffer=l,w.loop=!!S.loop;let I=e.ctx.createGain();w.connect(I),I.connect(e.masterNode);let v=(y=S.seek)!=null?y:0;w.start(0,v);let O=e.ctx.currentTime-v,_=null,f={stop(){A||(this.pause(),O=e.ctx.currentTime)},play(E){if(!A)return;let D=w;w=e.ctx.createBufferSource(),w.buffer=D.buffer,w.loop=D.loop,w.playbackRate.value=D.playbackRate.value,w.detune&&(w.detune.value=D.detune.value),w.connect(I);let F=E??this.time();w.start(0,F),O=e.ctx.currentTime-F,A=!1,_=null},pause(){A||(w.stop(),A=!0,_=e.ctx.currentTime)},paused(){return A},stopped(){return A},speed(E){return E!==void 0&&(w.playbackRate.value=ge(E,vr,xr)),w.playbackRate.value},detune(E){return w.detune?(E!==void 0&&(w.detune.value=ge(E,Sr,Ar)),w.detune.value):0},volume(E){return E!==void 0&&(I.gain.value=ge(E,Rt,Et)),I.gain.value},loop(){w.loop=!0},unloop(){w.loop=!1},duration(){return l.duration},time(){return A?_-O:e.ctx.currentTime-O}};return f.speed(S.speed),f.detune(S.detune),f.volume(S.volume),f}s(a,"play");function r(){return e.ctx}return s(r,"ctx"),{ctx:r,volume:t,play:a}}var Rt,Et,vr,xr,Sr,Ar,tn=me(()=>{Ce(),Rt=0,Et=3,vr=0,xr=3,Sr=-1200,Ar=1200,s(br,"audioInit")}),Rr,rn=me(()=>{Rr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvgAAAAICAYAAACML4vTAAAAAXNSR0IArs4c6QAABo1JREFUeJzdW9uO5SgMJKv9/1/OPnQnDabKVQb6zGgtjeYkvmJsYwh9tQLc931//7yu63retdba+/4hTZ6ZDMQ3wHVdPe1kXk/60He2D/J7HLMhGyOwHQKji/o/BYmv40DecRq+cfgr8l8dhBfRLPF3v6F9Cu/ObwFPYxRBFptE7mA/wQ2yWMwI/1r+y3Bq/h4H3TwJ3fl16xcz4UfQPB+oplF9QJ7id+SjMVjz/wf5e5rK+hKfB9+a86PsZTIm+7P6942jufsqSvg7/END5WSg6ojLt7uurcjL6v8pfQ4doinIL9v+f4HTMfQ3gopR5gOQ+6jviPj7EfLvqQGsQFiXb/B7KMBGc/rQ3x1ONuHmBmOQfd93XwDVguPI/3Uw/fc8Dz5s4/xMogU/xScNKILJb4W5Q/YyXtt+IWcyF+GzMajY7ehZbCK5vf2sGczmJ+J6O6J8pT8dB5HPwPU706/knsjfVRlxvhje0Zn5H+F/m/+kf6uA1oxqPVD1Jeqj+kHuRr5x0ZzzU8nJANrCalDS5A54xV9Ynyd+p/6bNXSiBfY5Dk1pkPyObzI0s10ceFr+3+FXsMq/qk+BM97TusU6bIvp+Flf1ufuy/OJBh817s/vlcKOaOHgRBOeyu0nppt4uIEA+gcboLLv96oIu18IFLhfSRooMh19hsvkKyNjkCo6R+fXC3ya/ddAdjrekxH2i8VmiH23oGTNYy+n2iBHyPhYjtWV8IJtyz38BW6a42JMKuJtn30IfgJT+PdkziayaP1W+OpX6J6HyJ+ac8MXaJEvNfnGGheVow34neAn/tag30aByRfI5PDBlZ9tzNghHuJDMnZpGO37rMam/L/Jj2w6wY/8TH1gPCNfQ3zxAJTZ3wPKkS9EIS9bm3OfbDonof9YWgw7gCJ0uqF+390/JIs1QZE+yhjkKOcifMKDdMX3kYbxKB3xn8fsNZEPPm2SBQ7KD/OkkgXZfYV/PV/U/+rok0IswDH+HDyCmAcuXs1LHP8gBzTyd487dIrgAPPfC489wK6K/GwjouYoo6nmZQXUHCtA9RThd+yX87fIn9X3T8Kkl2yC3zlS+NZK9XUClruFjU3093IcBFui8U79Zfg74Flj7dRHJJ/1Hq58xAs3JAdgNb9QDxHB9f8JfgSV+c96QaVnCcRhzx3+r+hXY9qtq1HmKy+up3Ft3T7BN06gWVDGZhI5JL4b6Mh9yolu5T6iukMN7M4KQqWZ/SKYP9+lYJyAOYtPveMy5IPdZja//XPVnkw+tBHdPe35w8kWs3UX+tjNrtggvpWvM3H8Lihi5f/dE1kVD068PL7O+Fc2z65eNseuDEfHKoxFpx4fjm9bS+LjFyEu4F8P4gras1geqq8QzK9wlJ3IWYJk3TtS8zbvV8MN2qGvaxQOXt3YafKe2NjN8U8A2hzGDQpdg37xqzurObB3dOY9uyYG8nG37pXjp9rg7wQm+v0A201GvGqUd4KfFlejgUobxCDjixAXod3NiWVfRaa6YsT0hitIWWAqXyr+JdhYBDJbSg32Y8fOFZvVDdziBq/cABPY8WEKpxf31fgnMM2xq681u9HYagAM/6mxDmM0eXaBNhCELgKt36Z+Vf9GYoDLrsg496TZ8yFg629dEL+D7sDq4FB8bIF7xTaxI2X8Q9dJWf7Y/ks2iPYGf2HsWf5HnOovUH2m4896Q9JDDs+rV7TduKs2+EcLNdnhvM/f+MqCEp8tO437h9C2YEP2nL7/5WR2G79sgYwGqo1ElJHu4F9msAkC84Lscxd4Bg5/ansGhVOAKf7MAuBu4NC8seJ1mQ0lku/okM090M/iS8HuAq/ivxJ/To1RMrDg/G8OTuVHub4e1j/wg9xBuF5fbPJVTlTsdOaPrmdiHVqK3UN/w+Xmz2r+K/mQf6G5RnauwDuHm80oGwCLkZMbHLYB/nkYm9Md/yF6NDa3SR9sNPM/0rD+cpgf8ws+qifOGN35XK2bHznBj3xWEKHTy+QT5HYiGJ83kW3lP5ZI4MTmKU1a9rcFbNyFT76OzVC+olP2tQYLEJNfGmO2iVs4AU/nd/PzejrHiM58z/BWvjnzs+J7QEvxzlcQgFupJxXfVuSjuFP11NFp4bI76IVnpZ/a7cxfRkNiIxtL9n41f1yayhrngmrG5LwYdWkp/x35h9Yg1WC6vlYNuStvKeZW+h9zfR/eIboHxD12Bml87PYgiCZZP5Z81fI5lrm5k0fxfWVj+x9lSgjp7YOOoAAAAABJRU5ErkJggg=="});function Pt(e){let t=new Image;return t.src=e,t.crossOrigin="anonymous",new Promise((a,r)=>{t.onload=()=>{a(t)},t.onerror=()=>{r(`failed to load ${e}`)}})}function Tt(e){return e.startsWith("data:")}function Pr(e,t,a={}){let r={lastLoaderID:0,loadRoot:"",loaders:{},sprites:{},sounds:{},fonts:{},shaders:{}};function l(_){var f;let E=r.lastLoaderID;r.loaders[E]=!1,r.lastLoaderID++,_.catch((f=a.errHandler)!=null?f:console.error).finally(()=>{r.loaders[E]=!0})}s(l,"addLoader");function S(){let _=0,f=0;for(let E in r.loaders)_+=1,r.loaders[E]&&(f+=1);return f/_}s(S,"loadProgress");function y(_){return _&&(r.loadRoot=_),r.loadRoot}s(y,"loadRoot");function A(_,f,E,D,F=Er){let z=new Promise((k,B)=>{let q=Tt(f)?f:r.loadRoot+f;Pt(q).then(R=>{let u=e.makeFont(e.makeTex(R),E,D,F);r.fonts[_]=u,k(u)}).catch(B)});return l(z),z}s(A,"loadFont");function w(_,f,E={sliceX:1,sliceY:1,anims:{}}){function D(z,k,B={sliceX:1,sliceY:1,gridWidth:0,gridHeight:0,anims:{}}){let q=[],R=e.makeTex(k),u=B.sliceX||R.width/(B.gridWidth||R.width),H=B.sliceY||R.height/(B.gridHeight||R.height),M=1/u,U=1/H;for(let ie=0;ie<H;ie++)for(let ue=0;ue<u;ue++)q.push(ye(ue*M,ie*U,M,U));let re={tex:R,frames:q,anims:B.anims||{}};return r.sprites[z]=re,re}s(D,"loadRawSprite");let F=new Promise((z,k)=>{if(!f)return k(`expected sprite src for "${_}"`);if(typeof f=="string"){let B=Tt(f)?f:r.loadRoot+f;Pt(B).then(q=>{z(D(_,q,E))}).catch(k)}else z(D(_,f,E))});return l(F),F}s(w,"loadSprite");function I(_,f,E,D=!1){function F(k,B,q){let R=e.makeProgram(B,q);return r.shaders[k]=R,R}s(F,"loadRawShader");let z=new Promise((k,B)=>{if(!f&&!E)return B("no shader");function q(R){return R?fetch(r.loadRoot+R).then(u=>{if(u.ok)return u.text();throw new Error(`failed to load ${R}`)}).catch(B):new Promise(u=>u(null))}if(s(q,"resolveUrl"),D)Promise.all([q(f),q(E)]).then(([R,u])=>{k(F(_,R,u))}).catch(B);else try{k(F(_,f,E))}catch(R){B(R)}});return l(z),z}s(I,"loadShader");function v(_,f){let E=r.loadRoot+f,D=new Promise((F,z)=>{if(!f)return z(`expected sound src for "${_}"`);typeof f=="string"&&fetch(E).then(k=>{if(k.ok)return k.arrayBuffer();throw new Error(`failed to load ${E}`)}).then(k=>new Promise((B,q)=>{t.ctx().decodeAudioData(k,B,q)})).then(k=>{r.sounds[_]=k,F(k)}).catch(z)});return l(D),D}s(v,"loadSound");function O(){return r.fonts[ke]}return s(O,"defFont"),A(ke,Rr,8,8),{loadRoot:y,loadSprite:w,loadSound:v,loadFont:A,loadShader:I,loadProgress:S,addLoader:l,defFont:O,sprites:r.sprites,fonts:r.fonts,sounds:r.sounds,shaders:r.shaders}}var Er,ke,nn=me(()=>{Ce(),rn(),Er=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",ke="unscii",s(Pt,"loadImg"),s(Tt,"isDataUrl"),s(Pr,"assetsInit")});function Ir(e,t,a={max:8}){var r;let l=[],S=(r=a.max)!=null?r:8;function y(){l.length>S&&(l=l.slice(0,S));let v=m(0,e.height());l.forEach((O,_)=>{let f=Je(_,0,S,1,.5),E=Je(_,0,S,.8,.2),D=(()=>{switch(O.type){case"info":return Z(1,1,1,f);case"error":return Z(1,0,.5,f)}})(),F=e.fmtText(O.msg,t.defFont(),{pos:v,origin:"botleft",color:D,size:Tr/e.scale(),width:e.width()});e.drawRect(v,F.width,F.height,{origin:"botleft",color:Z(0,0,0,E)}),e.drawFmtText(F),v.y-=F.height})}s(y,"draw");function A(v){console.error(v),l.unshift({type:"error",msg:v})}s(A,"error");function w(v){l.unshift({type:"info",msg:v})}s(w,"info");function I(){l=[]}return s(I,"clear"),{info:w,error:A,draw:y,clear:I}}var Tr,on=me(()=>{Ce(),Tr=16,s(Ir,"loggerInit")});function Mr(e){let t={},a=[],r=null;function l(){return r!==null&&r.readyState===1}s(l,"connected");function S(){let I=new WebSocket(e);return new Promise((v,O)=>{I.onopen=()=>{v(I),r=I;for(let _ of a)I.send(_)},I.onerror=()=>{O(`failed to connect to ${e}`)},I.onmessage=_=>{let f=JSON.parse(_.data);if(t[f.type])for(let E of t[f.type])E(f.data,f.id)}})}s(S,"connect");function y(I,v){t[I]||(t[I]=[]),t[I].push(v)}s(y,"recv");function A(I,v){let O=JSON.stringify({type:I,data:v});r?r.send(O):a.push(O)}s(A,"send");function w(){r&&r.close()}return s(w,"close"),{connect:S,close:w,connected:l,recv:y,send:A}}var sn=me(()=>{s(Mr,"netInit")}),an=$r((e,t)=>{Ce(),Zr(),en(),tn(),nn(),on(),sn(),t.exports=(a={width:640,height:480,scale:1,fullscreen:!1,debug:!1,crisp:!1,canvas:null,connect:null,logMax:8,root:document.body})=>{let r=wr({width:a.width,height:a.height,scale:a.scale,fullscreen:a.fullscreen,crisp:a.crisp,canvas:a.canvas,root:a.root}),l=yr(r.gl,{clearColor:a.clearColor?Z(a.clearColor):void 0,scale:a.scale,texFilter:a.texFilter}),S=br(),y=Pr(l,S,{errHandler:i=>{A.error(i)}}),A=Ir(l,y,{max:a.logMax}),w=(()=>a.connect?Mr(a.connect):null)();function I(i,o){if(!w)throw new Error("not connected to any websockets");w.recv(i,(d,p)=>{try{o(d,p)}catch(c){A.error(c)}})}s(I,"recv");function v(i,o){if(!w)throw new Error("not connected to any websockets");w.send(i,o)}s(v,"send");function O(){return r.dt()*Q.timeScale}s(O,"dt");function _(i,o={}){let d=y.sounds[i];if(!d)throw new Error(`sound not found: "${i}"`);return S.play(d,o)}s(_,"play");function f(i){var o;let d=R();return!((o=d.layers[i??d.defLayer])==null?void 0:o.noCam)}s(f,"isCamLayer");function E(i){return f(i)?R().cam.mpos:r.mousePos()}s(E,"mousePos");function D(i,o={}){var d;let p=(()=>typeof i=="string"?y.sprites[i]:i)();if(!p)throw new Error(`sprite not found: "${i}"`);let c=p.frames[(d=o.frame)!=null?d:0];l.drawTexture(p.tex,st(Be({},o),{quad:c}))}s(D,"drawSprite");function F(i,o={}){var d;let p=(d=o.font)!=null?d:ke,c=y.fonts[p];if(!c)throw new Error(`font not found: ${p}`);l.drawText(i,c,o)}s(F,"drawText");let z=980,k="topleft",B={loaded:!1,scenes:{},curScene:null,nextScene:null};function q(i,o){B.scenes[i]={init:o,initialized:!1,events:{add:[],update:[],draw:[],destroy:[],keyDown:[],keyPress:[],keyPressRep:[],keyRelease:[],mouseClick:[],mouseRelease:[],mouseDown:[],charInput:[]},action:[],render:[],objs:new Map,lastObjID:0,timers:{},lastTimerID:0,cam:{pos:m(l.width()/2,l.height()/2),scale:m(1,1),angle:0,shake:0,mpos:m(0),matrix:ae()},layers:{},defLayer:null,gravity:z,data:{}}}s(q,"scene");function R(){return B.scenes[B.curScene]}s(R,"curScene");function u(){return R().data}s(u,"sceneData");function H(){W("`",()=>{Q.showLog=!Q.showLog,A.info(`show log: ${Q.showLog?"on":"off"}`)}),W("f1",()=>{Q.inspect=!Q.inspect,A.info(`inspect: ${Q.inspect?"on":"off"}`)}),W("f2",()=>{Q.clearLog()}),W("f8",()=>{Q.paused=!Q.paused,A.info(`${Q.paused?"paused":"unpaused"}`)}),W("f7",()=>{Q.timeScale=ge(Q.timeScale-.2,0,2),A.info(`time scale: ${Q.timeScale.toFixed(1)}`)}),W("f9",()=>{Q.timeScale=ge(Q.timeScale+.2,0,2),A.info(`time scale: ${Q.timeScale.toFixed(1)}`)}),W("f10",()=>{Q.stepFrame(),A.info("stepped frame")})}s(H,"regDebugInputs");function M(i,...o){B.nextScene={name:i,args:[...o]}}s(M,"go");function U(i,...o){re(i),B.curScene=i;let d=B.scenes[i];if(!d)throw new Error(`scene not found: '${i}'`);if(!d.initialized){try{d.init(...o)}catch(p){A.error(p.stack)}a.debug&&H(),d.initialized=!0}}s(U,"goSync");function re(i){if(!B.scenes[i])throw new Error(`scene not found: '${i}'`);q(i,B.scenes[i].init)}s(re,"reload");function ie(i,o){let d=R();!d||(i.forEach((p,c)=>{d.layers[p]={alpha:1,order:c+1,noCam:!1}}),o&&(d.defLayer=o))}s(ie,"layers");function ue(...i){let o=R().cam;return i.length>0&&(o.pos=m(...i)),o.pos.clone()}s(ue,"camPos");function le(...i){let o=R().cam;return i.length>0&&(o.scale=m(...i)),o.scale.clone()}s(le,"camScale");function de(i){let o=R().cam;return i!==void 0&&(o.angle=i),o.angle}s(de,"camRot");function ve(i){let o=R().cam;o.shake=i}s(ve,"camShake");function fe(i){let o=R();i.forEach(d=>{o.layers[d]&&(o.layers[d].noCam=!0)})}s(fe,"camIgnore");function De(i){let o={hidden:!1,paused:!1,_tags:[],_id:null,_events:{add:[],update:[],draw:[],destroy:[],inspect:[]},use(c){if(c===void 0)return;let b=typeof c;if(b==="string"){this._tags.push(c);return}if(b!=="object")throw new Error(`invalid comp type: ${b}`);if(Array.isArray(c)){for(let h of c)this.use(h);return}for(let h in c){if(typeof c[h]=="function"){this._events[h]?this._events[h].push(c[h].bind(this)):this[h]=c[h].bind(this);continue}this[h]=c[h]}},exists(){return this._id!==void 0},is(c){if(c==="*")return!0;if(Array.isArray(c)){for(let b of c)if(!this._tags.includes(b))return!1;return!0}return this._tags.includes(c)},on(c,b){this._events[c]||(this._events[c]=[]),this._events[c].push(b)},action(c){this.on("update",c)},trigger(c,...b){if(this._events[c])for(let x of this._events[c])x.call(this,...b);let h=R().events[c];if(h)for(let x of h)this.is(x.tag)&&x.cb(this,...b)},rmTag(c){let b=this._tags.indexOf(c);b>-1&&this._tags.splice(b,1)}};o.use(i);let d=R(),p=d.lastObjID++;d.objs.set(p,o),o._id=p,o.trigger("add");for(let c of d.events.add)o.is(c.tag)&&c.cb(o);return o}s(De,"add");function g(i){if(!i.exists())return;let o=R();o.objs.delete(i._id);let d=o.lastObjID++;return o.objs.set(d,i),i._id=d,i}s(g,"readd");function P(i,o,d){let p=R();p.events[i]||(p.events[i]=[]),p.events[i].push({tag:o,cb:d})}s(P,"on");function T(i,o){typeof i=="function"&&o===void 0?R().action.push(i):typeof i=="string"&&P("update",i,o)}s(T,"action");function C(i,o){typeof i=="function"&&o===void 0?R().render.push(i):typeof i=="string"&&P("update",i,o)}s(C,"render");function j(i,o,d){T(i,p=>{p._checkCollisions(o,c=>{d(p,c)})})}s(j,"collides");function J(i,o,d){T(i,p=>{p._checkOverlaps(o,c=>{d(p,c)})})}s(J,"overlaps");function ee(i,o){T(i,d=>{d.isClicked()&&o(d)})}s(ee,"clicks");function Y(i,o){return new Promise(d=>{let p=R();p.timers[p.lastTimerID++]={time:i,cb:()=>{o&&o(),d()}}})}s(Y,"wait");function $(i,o){let d=!1,p=s(()=>{d||(o(),Y(i,p))},"newF");return p(),{stop(){d=!0}}}s($,"loop");function V(i,o,d){if(Array.isArray(o))for(let p of o)V(i,p,d);else R().events[i].push({key:o,cb:d})}s(V,"pushKeyEvent");function X(i,o){V("keyDown",i,o)}s(X,"keyDown");function W(i,o){V("keyPress",i,o)}s(W,"keyPress");function pe(i,o){V("keyPressRep",i,o)}s(pe,"keyPressRep");function Ee(i,o){V("keyRelease",i,o)}s(Ee,"keyRelease");function Ue(i){R().events.charInput.push({cb:i})}s(Ue,"charInput");function Xe(i){R().events.mouseDown.push({cb:i})}s(Xe,"mouseDown");function xe(i){R().events.mouseClick.push({cb:i})}s(xe,"mouseClick");function rt(i){R().events.mouseRelease.push({cb:i})}s(rt,"mouseRelease");function Se(i){let o=R(),d=[...o.objs.values()].sort((p,c)=>{var b,h,x,L,N,K;let oe=(x=(h=o.layers[(b=p.layer)!=null?b:o.defLayer])==null?void 0:h.order)!=null?x:0,Ae=(K=(N=o.layers[(L=c.layer)!=null?L:o.defLayer])==null?void 0:N.order)!=null?K:0;return oe-Ae});return i?d.filter(p=>p.is(i)):d}s(Se,"get");function ne(i,o){typeof i=="function"&&o===void 0?Se().forEach(i):typeof i=="string"&&Se(i).forEach(o)}s(ne,"every");function Fe(i,o){typeof i=="function"&&o===void 0?Se().reverse().forEach(i):typeof i=="string"&&Se(i).reverse().forEach(o)}s(Fe,"revery");function _e(i){if(!i.exists())return;let o=R();!o||(i.trigger("destroy"),o.objs.delete(i._id),delete i._id)}s(_e,"destroy");function qe(i){ne(i,o=>{_e(o)})}s(qe,"destroyAll");function je(i){let o=R();return i!==void 0&&(o.gravity=i),o.gravity}s(je,"gravity");function Pe(i){let o=R();if(!o)throw new Error(`scene not found: '${B.curScene}'`);let d=i||!Q.paused;if(d)for(let h in o.timers){let x=o.timers[h];x.time-=O(),x.time<=0&&(x.cb(),delete o.timers[h])}if(Fe(h=>{!h.paused&&d&&h.trigger("update")}),d)for(let h of o.action)h();let p=m(l.width(),l.height()),c=o.cam,b=or(Ke(0,Math.PI*2)).scale(c.shake);c.shake=Ve(c.shake,0,5*O()),c.matrix=ae().translate(p.scale(.5)).scale(c.scale).rotateZ(c.angle).translate(p.scale(-.5)).translate(c.pos.scale(-1).add(p.scale(.5)).add(b)),c.mpos=c.matrix.invert().multVec2(r.mousePos()),ne(h=>{h.hidden||(l.pushTransform(),f(h.layer)&&l.pushMatrix(c.matrix),h.trigger("draw"),l.popTransform())});for(let h of o.render)h()}s(Pe,"gameFrame");function nt(){let i=R();for(let o of i.events.charInput)r.charInputted().forEach(o.cb);for(let o of i.events.keyDown)r.keyDown(o.key)&&o.cb();for(let o of i.events.keyPress)r.keyPressed(o.key)&&o.cb();for(let o of i.events.keyPressRep)r.keyPressedRep(o.key)&&o.cb();for(let o of i.events.keyRelease)r.keyReleased(o.key)&&o.cb();for(let o of i.events.mouseDown)r.mouseDown()&&o.cb();for(let o of i.events.mouseClick)r.mouseClicked()&&o.cb();for(let o of i.events.mouseRelease)r.mouseReleased()&&o.cb()}s(nt,"handleEvents");function ot(){var i;let o=R(),d=null,p=y.defFont(),c=Z((i=a.inspectColor)!=null?i:[0,1,1,1]);function b(x,L,N){let K=m(4).scale(1/N),oe=l.fmtText(L,p,{size:12/N,pos:x.add(m(K.x,K.y))});l.drawRect(x,oe.width+K.x*2,oe.height+K.x*2,{color:Z(0,0,0,1)}),l.drawFmtText(oe)}s(b,"drawInspectTxt");function h(x,L){let N=f(x.layer),K=l.scale()*(N?(o.cam.scale.x+o.cam.scale.y)/2:1);N&&(l.pushTransform(),l.pushMatrix(o.cam.matrix)),L(K),N&&l.popTransform()}s(h,"drawObj"),Fe(x=>{!x.area||x.hidden||h(x,L=>{d||x.isHovered()&&(d=x);let N=(d===x?6:2)/L,K=x._worldArea(),oe=K.p2.x-K.p1.x,Ae=K.p2.y-K.p1.y;l.drawRectStroke(K.p1,oe,Ae,{width:N,color:c})})}),d&&h(d,x=>{let L=E(d.layer),N=[];for(let K of d._tags)N.push(`"${K}"`);for(let K of d._events.inspect){let oe=K();for(let Ae in oe)N.push(`${Ae}: ${oe[Ae]}`)}b(L,N.join(`
`),x)}),b(m(0),r.fps()+"",l.scale())}s(ot,"drawInspect");function Nt(i,...o){r.run(()=>{if(l.frameStart(),B.loaded){try{if(!R())throw new Error(`scene not found: '${B.curScene}'`);nt(),Pe(),Q.inspect&&ot()}catch(d){A.error(d.stack),r.quit()}Q.showLog&&A.draw(),B.nextScene&&(U.apply(null,[B.nextScene.name,...B.nextScene.args]),B.nextScene=null)}else{let d=y.loadProgress();if(d===1)B.loaded=!0,U(i,...o),w&&w.connect().catch(A.error);else{let p=l.width()/2,c=24/l.scale(),b=m(l.width()/2,l.height()/2).sub(m(p/2,c/2));l.drawRect(m(0),l.width(),l.height(),{color:at(0,0,0)}),l.drawRectStroke(b,p,c,{width:4/l.scale()}),l.drawRect(b,p*d,c)}}l.frameEnd()})}s(Nt,"start");function pt(...i){return{pos:m(...i),move(...o){let d=m(...o),p=d.x*O(),c=d.y*O();this.pos.x+=p,this.pos.y+=c},inspect(){return{pos:`(${~~this.pos.x}, ${~~this.pos.y})`}}}}s(pt,"pos");function mt(...i){return i.length===0?mt(1):{scale:m(...i),flipX(o){this.scale.x=Math.sign(o)*Math.abs(this.scale.x)},flipY(o){this.scale.y=Math.sign(o)*Math.abs(this.scale.y)}}}s(mt,"scale");function Ut(i){return{angle:i??0}}s(Ut,"rotate");function Xt(...i){return{color:Z(...i)}}s(Xt,"color");function qt(i){return{origin:i}}s(qt,"origin");function jt(i){return{layer:i,inspect(){var o;let d=R();return{layer:(o=this.layer)!=null?o:d.defLayer}}}}s(jt,"layer");function it(i,o){var d,p;let c=R();return((d=i.layer)!=null?d:c.defLayer)===((p=o.layer)!=null?p:c.defLayer)}s(it,"isSameLayer");function gt(i,o){let d={},p={};return{area:{p1:i,p2:o},areaWidth(){let{p1:c,p2:b}=this._worldArea();return b.x-c.x},areaHeight(){let{p1:c,p2:b}=this._worldArea();return b.y-c.y},isClicked(){return r.mouseClicked()&&this.isHovered()},isHovered(){return this.hasPt(E(this.layer))},isCollided(c){if(!c.area||!it(this,c))return!1;let b=this._worldArea(),h=c._worldArea();return xt(b,h)},isOverlapped(c){if(!c.area||!it(this,c))return!1;let b=this._worldArea(),h=c._worldArea();return fr(b,h)},clicks(c){this.action(()=>{this.isClicked()&&c()})},hovers(c){this.action(()=>{this.isHovered()&&c()})},collides(c,b){this.action(()=>{this._checkCollisions(c,b)})},overlaps(c,b){this.action(()=>{this._checkOverlaps(c,b)})},hasPt(c){let b=this._worldArea();return pr({p1:b.p1,p2:b.p2},c)},resolve(){let c=[];return ne(b=>{if(b===this||!b.solid||!b.area||!it(this,b))return;let h=this._worldArea(),x=b._worldArea();if(!xt(h,x))return;let L=h.p2.x-x.p1.x,N=x.p2.x-h.p1.x,K=h.p2.y-x.p1.y,oe=x.p2.y-h.p1.y,Ae=Math.min(L,N,K,oe),zr=(()=>{switch(Ae){case L:return this.pos.x-=L,"right";case N:return this.pos.x+=N,"left";case K:return this.pos.y-=K,"bottom";case oe:return this.pos.y+=oe,"top"}})();c.push({obj:b,side:zr})}),c},_checkCollisions(c,b){ne(c,h=>{this!==h&&(d[h._id]||this.isCollided(h)&&(b(h),d[h._id]=h))});for(let h in d){let x=d[h];this.isCollided(x)||delete d[h]}},_checkOverlaps(c,b){ne(c,h=>{this!==h&&(p[h._id]||this.isOverlapped(h)&&(b(h),p[h._id]=h))});for(let h in p){let x=p[h];this.isOverlapped(x)||delete p[h]}},_worldArea(){let c=this.area,b=this.pos||m(0),h=this.scale||m(1),x=b.add(c.p1.dot(h)),L=b.add(c.p2.dot(h));return{p1:m(Math.min(x.x,L.x),Math.min(x.y,L.y)),p2:m(Math.max(x.x,L.x),Math.max(x.y,L.y))}}}}s(gt,"area");function Ge(i,o,d){let p=m(i,o),c=We(d||k).dot(p).scale(-.5);return gt(c.sub(p.scale(.5)),c.add(p.scale(.5)))}s(Ge,"getAreaFromSize");function Gt(i,o={}){let d=y.sprites[i];if(!d)throw new Error(`sprite not found: "${i}"`);let p=Be({},d.frames[0]);o.quad&&(p.x+=o.quad.x*p.w,p.y+=o.quad.y*p.h,p.w*=o.quad.w,p.h*=o.quad.h);let c=d.tex.width*p.w,b=d.tex.height*p.h,h=null;return{width:c,height:b,animSpeed:o.animSpeed||.1,frame:o.frame||0,quad:o.quad||ye(0,0,1,1),add(){!this.area&&!o.noArea&&this.use(Ge(this.width,this.height,this.origin))},draw(){let x=R(),L=d.frames[this.frame];D(d,{pos:this.pos,scale:this.scale,rot:this.angle,color:this.color,frame:this.frame,origin:this.origin,quad:this.quad,prog:y.shaders[this.shader],uniform:this.uniform})},update(){if(!h)return;let x=d.anims[h.name];h.timer+=O(),h.timer>=this.animSpeed&&(this.frame++,this.frame>x.to&&(h.loop?this.frame=x.from:(this.frame--,this.stop())),h&&(h.timer-=this.animSpeed))},play(x,L=!0){let N=d.anims[x];if(!N)throw new Error(`anim not found: ${x}`);h&&this.stop(),h={name:x,loop:L,timer:0},this.frame=N.from,this.trigger("animPlay",x)},stop(){if(!h)return;let x=h.name;h=null,this.trigger("animEnd",x)},changeSprite(x){if(d=y.sprites[x],!d)throw new Error(`sprite not found: "${x}"`);let L=Be({},d.frames[0]);o.quad&&(L.x+=o.quad.x*L.w,L.y+=o.quad.y*L.h,L.w*=o.quad.w,L.h*=o.quad.h),this.width=d.tex.width*L.w,this.height=d.tex.height*L.h,this.area&&!o.noArea&&this.use(Ge(this.width,this.height,this.origin)),h=null,this.frame=0},numFrames(){return d.frames.length},curAnim(){return h==null?void 0:h.name},inspect(){let x={};return h&&(x.curAnim=`"${h.name}"`),x}}}s(Gt,"sprite");function zt(i,o,d={}){return{text:i,textSize:o,font:d.font,width:0,height:0,add(){var p,c,b;if(!this.area&&!d.noArea){let h=R(),x=y.fonts[(p=this.font)!=null?p:ke],L=l.fmtText(this.text+"",x,{pos:this.pos,scale:this.scale,rot:this.angle,size:this.textSize,origin:this.origin,color:this.color,width:d.width});this.width=L.width/(((c=this.scale)==null?void 0:c.x)||1),this.height=L.height/(((b=this.scale)==null?void 0:b.y)||1),this.use(Ge(this.width,this.height,this.origin))}},draw(){var p;let c=R(),b=y.fonts[(p=this.font)!=null?p:ke],h=l.fmtText(this.text+"",b,{pos:this.pos,scale:this.scale,rot:this.angle,size:this.textSize,origin:this.origin,color:this.color,width:d.width});this.width=h.width,this.height=h.height,l.drawFmtText(h)}}}s(zt,"text");function Vt(i,o,d={}){return{width:i,height:o,add(){!this.area&&!d.noArea&&this.use(Ge(this.width,this.height,this.origin))},draw(){let p=R();l.drawRect(this.pos,this.width,this.height,{scale:this.scale,rot:this.angle,color:this.color,origin:this.origin,prog:y.shaders[this.shader],uniform:this.uniform})}}}s(Vt,"rect");function Jt(){return{solid:!0}}s(Jt,"solid");let jr=960,Gr=480;function Kt(i={}){var o,d;let p=0,c=null,b=null,h=(o=i.maxVel)!=null?o:jr;return{jumpForce:(d=i.jumpForce)!=null?d:Gr,update(){this.move(0,p);let x=this.resolve(),L=!1;if(c&&(!c.exists()||!this.isCollided(c)?(c=null,b=null,L=!0):b&&(this.pos=this.pos.add(c.pos.sub(b)),b=c.pos.clone())),!c){p=Math.min(p+je()*O(),h);for(let N of x)N.side==="bottom"&&p>0?(c=N.obj,p=0,b=c.pos.clone(),L||this.trigger("grounded",c)):N.side==="top"&&p<0&&(p=0,this.trigger("headbump",N.obj))}},curPlatform(){return c},grounded(){return c!==null},falling(){return p>0},jump(x){c=null,p=-x||-this.jumpForce}}}s(Kt,"body");function Wt(i,o={}){let d=y.shaders[i];return{shader:i,uniform:o}}s(Wt,"shader");let Q={paused:!1,inspect:!1,timeScale:1,showLog:!0,fps:r.fps,objCount(){return R().objs.size},stepFrame(){Pe(!0)},drawCalls:l.drawCalls,clearLog:A.clear,log:A.info,error:A.error};function $t(i,o){let d=[],p=m(o.pos||0),c=0,b={getPos(...h){let x=m(...h);return m(p.x+x.x*o.width,p.y+x.y*o.height)},spawn(h,x){let L=(()=>{if(Array.isArray(h))return h;if(o[h]){if(typeof o[h]=="function")return o[h]();if(Array.isArray(o[h]))return[...o[h]]}else if(o.any)return o.any(h)})();if(!L)return;L.push(pt(p.x+x.x*o.width,p.y+x.y*o.height));let N=De(L);return d.push(N),N.use({gridPos:x.clone(),setGridPos(K){this.gridPos=K.clone(),this.pos=m(p.x+this.gridPos.x*o.width,p.y+this.gridPos.y*o.height)},moveLeft(){this.setGridPos(this.gridPos.add(m(-1,0)))},moveRight(){this.setGridPos(this.gridPos.add(m(1,0)))},moveUp(){this.setGridPos(this.gridPos.add(m(0,-1)))},moveDown(){this.setGridPos(this.gridPos.add(m(0,1)))}}),N},width(){return c*o.width},height(){return i.length*o.height},destroy(){for(let h of d)_e(h)}};return i.forEach((h,x)=>{let L=h.split("");c=Math.max(L.length,c),L.forEach((N,K)=>{b.spawn(N,m(K,x))})}),b}s($t,"addLevel");let ze={start:Nt,loadRoot:y.loadRoot,loadSprite:y.loadSprite,loadSound:y.loadSound,loadFont:y.loadFont,loadShader:y.loadShader,addLoader:y.addLoader,width:l.width,height:l.height,dt:O,time:r.time,screenshot:r.screenshot,scene:q,go:M,sceneData:u,layers:ie,camPos:ue,camScale:le,camRot:de,camShake:ve,camIgnore:fe,gravity:je,add:De,readd:g,destroy:_e,destroyAll:qe,get:Se,every:ne,revery:Fe,send:v,recv:I,pos:pt,scale:mt,rotate:Ut,color:Xt,origin:qt,layer:jt,area:gt,sprite:Gt,text:zt,rect:Vt,solid:Jt,body:Kt,shader:Wt,on:P,action:T,render:C,collides:j,overlaps:J,clicks:ee,keyDown:X,keyPress:W,keyPressRep:pe,keyRelease:Ee,charInput:Ue,mouseDown:Xe,mouseClick:xe,mouseRelease:rt,mousePos:E,cursor:r.cursor,keyIsDown:r.keyDown,keyIsPressed:r.keyPressed,keyIsPressedRep:r.keyPressedRep,keyIsReleased:r.keyReleased,mouseIsDown:r.mouseDown,mouseIsClicked:r.mouseClicked,mouseIsReleased:r.mouseReleased,loop:$,wait:Y,play:_,volume:S.volume,makeRng:wt,rand:Ke,randSeed:cr,vec2:m,rgb:at,rgba:Z,quad:ye,choose:hr,chance:dr,lerp:Ve,map:Je,mapc:nr,wave:ar,deg2rad:tr,rad2deg:rr,drawSprite:D,drawText:F,drawRect:l.drawRect,drawRectStroke:l.drawRectStroke,drawLine:l.drawLine,debug:Q,addLevel:$t};if(a.plugins)for(let i of a.plugins){let o=i(ze);for(let d in o)ze[d]=o[d]}if(a.global)for(let i in ze)window[i]=ze[i];return ze}}),Dr=an();function It(e){function t(w,I){!w.exists()||w.on("destroy",()=>{e.destroy(I)})}function a(){let w=Date.now();return{age(){return Date.now()-w}}}function r(w){return{decay:1,...a(),update(){this.decay=1-this.age()/w,this.decay<=0&&e.destroy(this)}}}function l(){let w=e.pos();return{delta:e.vec2(0,0),add(){Object.assign(w,this.pos)},update(){this.delta=this.pos.sub(w),Object.assign(w,this.pos)}}}function S(w,I,v){return{add(){this.use([e.pos(w.pos),e.origin(w.origin)])},update(){let O=e.rotateVec(I,this.angle);v&&(O=O.scale(1+v-v*this.decay)),this.pos=w.pos.add(O)}}}function y(w,I=0){return{add(){this.use([e.rotate(I),e.origin("center")])},update(){this.angle+=e.dt()*e.gravity()/w}}}function A(w,I=!1){return{add(){this.use([e.pos(w.pos),e.rotate(w.angle),e.origin(w.origin)]),I&&t(w,this)},update(){this.pos=w.pos,this.angle=w.angle}}}return{age:a,decay:r,delta:l,orbit:S,spin:y,sync:A}}function Fr(e,t){return Number.isInteger(e)?(e+t)%t:t*e}function _r(e,t=1){return e.join(`
`.repeat(t+1))}function Mt(e){function t(l,S,y,A=1){return e.add([e.pos(Fr(S,e.width()),Fr(y,e.height())),e.color(A,A,A),e.layer("gui"),...l])}function a(l,S,y,A,w){return e.add([e.text(_r(l,A),w,{width:e.width()-2*S}),e.pos(S,y),{setText(I){this.text=_r(I,A)}}])}function r(l,S){let y=e.addGUI([e.text(l+1,32),e.origin("center")],.5,.5);return e.loop(1,()=>{let A=y.text-1;A===0?S():y.text=A}),y}return{addGUI:t,addMessage:a,addCountdown:r}}function Dt(e){function t(a,r=!0){let l=!0,S=!1;return{add(){e.mouseDown(()=>{if(!this.layer&&l){l=!1,S=!1;return}if(this.isHovered()){if(S)return;a.call(this),S=r}else S=!1}),e.mouseRelease(()=>{l=!0,S=!1})}}}return{touches:t}}function Ft(e){function t(){return e.vec2(e.width()/2,e.height()/2)}function a({p1:l,p2:S}){return l.dist(S)}function r(l,S){let{x:y,y:A}=e.vec2(l);return e.vec2(y*Math.cos(S)-A*Math.sin(S),y*Math.sin(S)+A*Math.cos(S))}return{center:t,diagonal:a,rotateVec:r}}var He={MIN:1,MAX:3},he={SHIP:{X:100,Y:10},DEBRIS:{X:100,Y:-100}},G={GAME:{X:800,Y:800},SHIP:{X:20,Y:40},BOOST:{X:10,Y:10},FLAME:{X:20,Y:5},SHIELD:{X:25,Y:45},SAT:{X:10,Y:10},STAR:{X:5,Y:5},DEBRIS:{MIN:{X:10,Y:10},MAX:{X:25,Y:25}}},Qe={BOOST:5,DEBRIS:3},Br={GRAVITY:100},be={BOOST:-1e3,DEBRIS:500,SAT:200,SPARK:-200},we={FLAME:1e3,FIRE:500,INFO:500,SAT:1e3,SHIELD:4e3,SPARK:2e3,TAIL:200},_t={BOOST:10,DEBRIS:50},Bt={BOOST:6,DEBRIS:12},dt={SAT:3,INFO:6},Or={FLAME:40},Re=1e3,Lr=10,Cr=20,Yr=480,Ot=100;var Ie=!1,ht="0.1.30",kr={};function Hr(e,t,a){return Math.max(t,Math.min(a,e))}function Nr(e,t){return Math.max(t,Math.abs(e))*Math.sign(e)}function Ze(e){document.body.classList.toggle("mouse-control",e)}function Ur(){if(Ie||document.fullscreenElement)return;document.querySelector("canvas").requestFullscreen().catch(console.error)}function Xr(){let e=localStorage.getItem("highscore");return e?parseInt(e,10):0}function qr(e){let t=Math.max(-1,...e);for(let a=0;a<t;a++)if(!e.includes(a))return a;return t+1}function Lt(e){function t(f){let E=kr.extraBoost?!1:f%dt.SAT==dt.SAT-1;return e.add([e.rect(G.BOOST.X,G.BOOST.Y),e.pos(e.rand(G.SHIP.X,e.width()-G.SHIP.X),e.rand(G.SHIP.Y,e.height()-G.SHIP.Y)),e.color(0,1,.5),e.spin(be.BOOST/Math.sqrt(f+1)),"boost",{extra:E}])}function a(){let f=e.rand(0,e.width()),E=e.rand(0,Math.sign(e.width()/2-f)),D=e.rand(G.DEBRIS.MIN.X,G.DEBRIS.MAX.X),F=e.rand(G.DEBRIS.MIN.Y,G.DEBRIS.MAX.Y),z=be.DEBRIS*Math.sign(D-F);return e.add([e.rect(D,F),e.pos(f,-e.height()),e.color(1,1,1),e.body(),e.spin(z),"debris",{direction:E}])}function r(f){return e.add([e.rect(f.width,f.height),e.pos(f.pos.x,f.pos.y),e.rotate(f.angle),e.color(1,0,0),e.layer("background"),e.origin("center"),e.decay(we.FIRE),"fire"])}function l(f,E){let D=e.rotateVec([0,f.height/2],-f.angle),F=e.rotateVec([0,G.FLAME.Y],-f.angle).x;return e.add([e.rect(G.FLAME.X,G.FLAME.Y),e.pos(f.pos.add(D)),e.rotate(f.angle),e.color(...E?[0,1,1]:[1,1,0]),e.scale(1),e.layer("background"),e.origin("center"),e.decay(we.FLAME),"flame",{direction:F}])}function S(f,E=24,D=e.center()){let F=Math.max(1,f.length/dt.INFO);return e.add([e.text(f,E),e.color(1,1,0),e.scale(1),e.decay(we.INFO*F),e.pos(D),e.origin("center"),"fading"])}function y(f){let{r:E,g:D,b:F}=f.color;return e.add([e.rect(1,e.height()),e.color(E,D,F,.5),e.scale(0),e.sync(f,!0),"pulse"])}function A(f){let E=e.get("satellite").map(({index:F})=>F),D=qr(E);return e.add([e.rect(G.SAT.X,G.SAT.Y),e.color(0,1,1),e.spin(be.SAT,Math.PI*2/(D+1)),e.orbit(f,G.SHIP.X*D+G.SHIP.Y*2),"satellite",{index:D}])}function w(f,E){return S(`${f}`,15+f/10,E)}function I(f){return e.add([e.rect(G.SHIELD.X,G.SHIELD.Y),e.color(0,1,1),e.scale(1),e.layer("background"),e.decay(we.SHIELD),e.sync(f),"shield","fading"])}function v(f){let{width:E,height:D,color:F,pos:z}=f,k=[E/2,D/2];return e.add([e.rect(...k),e.color(F),e.pos(z),e.spin(be.SPARK),e.decay(we.SPARK),e.orbit(f,k,4),"spark",{center:z}])}function O(f=0){return e.add([e.rect(G.STAR.X,G.STAR.Y),e.pos(e.rand(0,e.width()-G.STAR.X),e.height()*1.5-e.camPos().y-f),e.color(1,1,1,e.rand(.1,.9)),e.layer("background"),e.age(),"star"])}function _(f){let{r:E,g:D,b:F}=f.color;return e.add([e.scale(1),e.color(E/2,D/2,F/2),e.pos(f.pos),e.rect(f.width,f.height),e.rotate(f.angle),e.origin("center"),e.layer("background"),e.decay(we.TAIL),"tail"])}return{spawnBoost:t,spawnDebris:a,spawnFire:r,spawnFlame:l,spawnInfo:S,spawnPulse:y,spawnSatellite:A,spawnScore:w,spawnShield:I,spawnSpark:v,spawnStar:O,spawnTail:_}}var ce=He.MIN,ft=Xr(),et=null,tt=!0;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),et=e});function Ne(e,t){e.color.a=t?.5:1}function un(){let e=null;!ht||n.render(()=>{e||!et||(e=n.addGUI([n.text("install"),n.origin("bot"),n.touches(()=>{et.prompt(),et.userChoice.then(({outcome:t})=>{t==="accepted"&&(n.destroy(e),et=null)})}),"control"],.5,-te))})}function ln(){let e=document.getElementById("instructions").textContent.replace(/\s+/g," ").trim(),t=n.add([n.text(e),n.pos(n.width(),300),"instructions"]);t.action(()=>{t.pos.x-=n.dt()*100,t.pos.x<-t.areaWidth()&&(t.pos.x=n.width())})}function cn(){let e=n.addGUI([n.text("sound",16),n.origin("topleft"),n.touches(()=>{let a=n.volume((n.volume()+1)%2);Ne(e,a===0)}),"control"],te,100),t=n.addGUI([n.text("shake",16),n.origin("topright"),n.touches(()=>{tt=!tt,Ne(t,!tt)}),"control"],-te,100);Ne(e,n.volume()===0),Ne(t,!tt)}function dn(){let e=n.height();n.add([n.rect(te,e),n.pos(0,0),n.color(0,0,0)]),n.add([n.rect(te,e),n.pos(n.width(),0),n.color(0,0,0),n.origin("right")])}function Ct(e=0){let t=n.addMessage([],te,200,1,12);ft=Math.max(e,ft),localStorage.setItem("highscore",ft);function a(){t.setText([`Difficulty: ${ce}`,`Highscore: ${ft}`]),n.every("difficulty+",y=>{Ne(y,ce===He.MAX)}),n.every("difficulty-",y=>{Ne(y,ce===He.MIN)})}function r(y){ce=Hr(y,He.MIN,He.MAX),a()}function l(){n.addGUI([n.text("+",32),n.origin("topright"),n.touches(()=>{r(ce+1)}),"control","difficulty+"],-te,te),n.addGUI([n.text("-",32),n.origin("topleft"),n.touches(()=>{r(ce-1)}),"control","difficulty-"],te,te),n.addGUI([n.text("START",32),n.origin("top"),n.touches(()=>{n.addCountdown(3,()=>{n.go("main",ce,!0,tt)}),n.destroy(t),n.destroyAll("control"),n.destroyAll("instructions"),Ur()}),"control"],.5,te)}function S(){n.addMessage(["Press SPACE to start falling!","Use UP and DOWN to adjust the difficulty.","Better played on your phone though."],te,300,2),n.mouseClick(()=>{n.go("main",ce,!0,!1)})}n.layers(["gui"]),n.camIgnore(["gui"]),Me?(l(),un(),ln(),cn()):S(),ht&&n.addGUI([n.text(ht),n.origin("botright"),n.touches(()=>{n.go("credits")}),"control"],-te,-te),n.every("control",y=>{let A=n.vec2(0,y.areaHeight());y.area.p2=y.area.p2.add(A)}),n.keyPress("space",()=>{n.go("main",ce,!1,!1)}),n.keyPress("up",()=>{r(ce+1),a()}),n.keyPress("down",()=>{r(ce-1),a()}),a(),dn()}function Yt(e,t,a){let r=n.play("soundtrack"),l=!1,S=!1,y=0,A=0;r.loop(),n.layers(["gui","background","game"],"game"),n.addGUI([n.text("G"),n.origin("botright")],-10,-10,.5);let w=n.addGUI([n.text(),{value:0}],10,10),I=n.addGUI([n.rect(10,0),n.origin("botright"),{value:Re}],-10,-25,.5),v=n.add([n.body({jumpForce:Yr}),n.pos(n.width()/2,n.height()/1.5),n.rect(G.SHIP.X,G.SHIP.Y),n.color(1,1,1),n.rotate(0),n.origin("center"),n.delta()]);function O(u,H,M=v.pos){H&&(u*=e,n.spawnScore(u,M)),w.value+=u,w.text=w.value}function _(u){I.value=Math.max(Re,I.value+u),I.height=(I.value-Re)/100,n.gravity(I.value)}function f(u){return(...H)=>!l&&u(...H)}function E(){let u=n.width();v.angle=(v.pos.x-u/2)/-u}function D(){let u=Math.min(0,v.pos.y-Cr);n.camPos(n.camPos().x,n.height()/2+u)}function F(u){A++,u.color=n.rgba(1,.5,0),u.direction=u.direction*-2,n.play("crash"),u.use(n.layer("background")),O(_t.DEBRIS*A,!0,u.pos)}function z(){let u=n.mousePos(),H=n.width();if(u.x<0&&v.pos.x<v.width||u.x>H&&v.pos.x>H-v.width)return;let M=Nr(n.mousePos().sub(v.pos).x,he.SHIP.X);v.move(M,he.SHIP.Y*Math.abs(M)/he.SHIP.X)}function k(){n.every("satellite",u=>{u.use([n.layer("background"),n.decay(we.SAT),"fading"])})}function B(){let u=n.get("flame").pop();(!u||u.age()>Or.FLAME)&&n.spawnFlame(v,S)}function q(){v.pos.y<0||(v.jump(),n.spawnFlame(v,S))}function R(u){n.camShake(u),a&&navigator.vibrate([u*10])}v.action(()=>{if(v.pos.y>=n.height())return n.destroy(v);if(l)return n.spawnFire(v);t&&z(),v.delta.y<-1&&B(),D(),E()}),v.collides("boost",u=>{let H=e/2;y++,v.jump(I.value*H),n.destroy(u),n.destroyAll("shield"),n.play("booster"),n.spawnSpark(u),R(Bt.BOOST),O(_t.BOOST*y,!0),_((Re-I.value)*H),!l&&(n.spawnShield(v),u.extra&&n.spawnSatellite(v))}),v.collides("debris",u=>{if(R(Bt.DEBRIS),S)return F(u);l=!0,v.jump(Re),v.use(n.spin(be.DEBRIS)),n.spawnInfo("FUCK",32),n.play("crash",{volume:2}),n.destroy(u),k()}),v.on("destroy",()=>{r.stop(),n.play("gameover"),n.go("death",w.value,l)}),n.collides("debris","satellite",(u,H)=>{F(u),n.destroy(H)}),n.action("star",u=>{u.pos.y-=u.age()/I.value*u.color.a,u.pos.y<-u.height&&(n.destroy(u),n.spawnStar())}),n.action("flame",u=>{let{r:H,b:M}=u.color;u.color=n.rgba(H,u.decay,M,u.decay),u.scale=n.vec2(.5+u.decay/2,1),u.pos.x+=u.direction}),n.action("fire",u=>{let H=u.decay-n.rand(0,u.decay);u.color=n.rgba(H,n.rand(0,H/2),0,u.decay),u.angle+=n.dt(),u.scale=H}),n.action("tail",u=>{let{r:H,g:M,b:U}=u.color;u.color=n.rgba(H,M,U,u.decay),u.scale=n.vec2(u.decay,u.decay)}),n.action("pulse",u=>{u.scale=Math.cos(u.angle)}),n.action("spark",u=>{u.color.a=u.decay}),n.action("fading",u=>{u.color.a=u.decay,u.scale=1.2-u.decay/5}),n.action("debris",u=>{if(u.pos.y>n.height()+u.height)return A=0,n.destroy(u);u.move(he.DEBRIS.X*u.direction,he.DEBRIS.Y/e-n.diagonal(u.area)),n.spawnTail(u)}),n.action("shield",u=>{r.detune(Ot*u.decay)}),n.action("satellite",u=>{u.is("fading")||n.spawnTail(u)}),n.on("add","boost",u=>{n.wait(Qe.BOOST,()=>{!u.exists()||(y=0,n.destroy(u),k())}),u.extra&&n.spawnPulse(u)}),n.on("destroy","boost",()=>{n.wait(Qe.BOOST,()=>{n.spawnBoost(y)})}),n.on("add","shield",()=>{S=!0,r.detune(Ot)}),n.on("destroy","shield",()=>{S=!1,r.detune(0)}),n.gravity(Re),n.camIgnore(["gui"]),n.loop(1/e,()=>{O(1),_(Br.GRAVITY)}),n.mouseClick(f(()=>{t||Ze(t=!0),q()})),n.keyPress("space",f(q)),n.keyDown("left",f(()=>{v.pos.x-v.width>0&&v.move(-he.SHIP.X,he.SHIP.Y)})),n.keyDown("right",f(()=>{v.pos.x+v.width<n.width()&&v.move(he.SHIP.X,he.SHIP.Y)})),n.wait(Qe.BOOST,()=>{n.spawnBoost(y)}),n.loop(Qe.DEBRIS,n.spawnDebris),Ze(t);for(let u=0;u<Lr;u++)n.spawnStar(n.rand(0,n.height()));if(!!Ie){for(let u=0;u<10;u++)n.keyPress(`${u}`,()=>{y=u});n.keyPress("k",()=>{l=!0,v.jump(Re),v.use(n.spin(be.DEBRIS))})}}function kt(e,t){n.addMessage([t?"Wrecked by space debris!":n.choose(["Gravity ate you up!","Newton fucked you!","There's no light at the end of the wormhole!","You could not resist the force of gravity!"]),`Your score was ${e}.`],te,200,2),n.wait(3,()=>n.go("start",e)),Ze(!1)}function Ht(){n.addMessage(["code by m3g4p0p","sound by robo","","copyright 2021"],te,te),n.mouseClick(()=>{n.go("start")})}var Me=window.innerWidth<G.GAME.X||window.innerHeight<G.GAME.Y,n=window.k=Dr({fullscreen:Me,width:Me?null:G.GAME.X,height:Me?null:G.GAME.Y,clearColor:[0,0,0],plugins:[It,Mt,Dt,Ft,Lt],debug:Ie}),te=Me?20:100;n.loadSound("soundtrack","media/soundtrack.mp3");n.loadSound("gameover","media/gameover.mp3");n.loadSound("booster","media/booster.mp3");n.loadSound("crash","media/crash.mp3");n.scene("start",Ct);n.scene("main",Yt);n.scene("death",kt);n.scene("credits",Ht);n.start("start");document.body.classList.toggle("is-fullscreen",Me);"serviceWorker"in navigator&&!Ie&&navigator.serviceWorker.register("sw.js").catch(console.error);})();
//# sourceMappingURL=game.js.map
